<!DOCTYPE html>
<html data-n-head-ssr data-n-head="">
  <head>
    <meta data-n-head="true" charset="utf-8"/><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/><meta data-n-head="true" name="description" content="文蔺的前端学习记录，国外技术文章翻译，个人学习心得等等这些都会记录在这里。"/><meta data-n-head="true" name="keywords" content="翻译,CSS,性能"/><meta data-n-head="true" name="description" content="font-display 的使用"/><title data-n-head="true">[译] font-display 的使用 | 文蔺的博客</title><link data-n-head="true" rel="favicon" href="/favicon.ico"/><link rel="stylesheet" href="/static/common.5ad111a3.css"><style data-vue-ssr-id="645210e9:0">#__layout,#__nuxt,.wrapper{width:100%;height:100%}.main{height:100%}.main>article,.main>div,.main>section{min-height:100%;margin-bottom:-81px}.main>article:after,.main>div:after,.main>section:after{display:block;content:"";height:81px}.main>article,.main>div,.main>section{border-bottom:0}.main>#footer{position:relative;z-index:1;border-top:0}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><div class="nuxt-progress" style="width:0%;height:2px;background-color:black;opacity:0;"></div><div id="__layout"><div class="wrapper"><nav id="sidebar" class="behavior_1"><div class="wrap"><div class="profile"><a href="/" class="nuxt-link-active"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a><span>文蔺的博客</span></div><ul class="buttons"><li><a href="/" title="主页" class="nuxt-link-active"><i class="iconfont icon-home"></i><span> 主页</span></a></li><li><a href="/archives" title="归档"><i class="iconfont icon-archive"></i><span> 归档</span></a></li><li><a href="/tags" title="标签"><i class="iconfont icon-tags"></i><span> 标签</span></a></li><li><a href="/about" title="关于"><i class="iconfont icon-user"></i><span> 关于</span></a></li><li><a href="/link" title="关注"><i class="iconfont icon-link"></i><span> 关注</span></a></li><li><a href="/collection" title="收藏"><i class="iconfont icon-archive"></i><span> 收藏</span></a></li></ul></div><ul class="buttons"><li><a href="https://github.com/AngusFu/" rel="nofollow" target="_blank" class="inline"><i title="GitHub" class="iconfont icon-github-v"></i></a><!----><!----><a href="/atom.xml" target="_blank" class="inline"><i title="RSS" class="iconfont icon-rss-v"></i></a><a href="/search" class="inline"><i title="Search" class="iconfont icon-search"></i></a></li></ul></nav><div id="header"><div class="btn-bar"><i></i></div><h1><a href="/" class="nuxt-link-active">文蔺的博客</a></h1><a href="/about/" class="me"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a></div><div id="sidebar-mask" style="display:none;"></div><div id="main" class="main"><div id="page-post"><article class="post detail"><div class="meta"><div class="date">2017-08-04</div></div><h1 class="title">[译] font-display 的使用</h1><div class="entry-content"><blockquote><p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
        原文作者: <a href="https://twitter.com/rob_dodson" target="_blank">Rob Dodson</a><br>
        原文地址: <a href="https://developers.google.com/web/updates/2016/02/font-display">https://developers.google.com/web/updates/2016/02/font-display</a><br>
        译文地址: <a href="http://www.wemlion.com/post/font-display">http://www.wemlion.com/post/font-display</a><br>
        本文由 <a href="http://www.wemlion.com">文蔺</a> 翻译，转载请保留此声明。<br>
        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。
        </p></blockquote><p>进行性能优化时，决定 Web Font 的加载行为是一项技术活。<textarea width="0" height="0" class="codespan" style="display:none;">@font-face</textarea>规则中新增了一个<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>声明，开发者可以根据 Web Font 的加载时间来决定如何渲染或降级处理。</p><h2 id="-">字体渲染差异</h2><p>有了 Web Font，开发者可以在项目中加入丰富的排版功能。但需要权衡的是，下载字体会耗费一些时间。而下载时间难免会受到网络状况的影响，继而干扰用户体验。说实话，如果连页面展示都费劲，谁还会在乎你用多炫的字体呢。</p><p>字体下载可能比较慢，为了减轻风险，大多数浏览器都采用了超时处理。一旦超时，就使用后备字体。理想很美好，现实很无奈，浏览器在实现上各有自己的一套。</p><table><thead><tr><th style="text-align:left">Browser</th><th style="text-align:left">Timeout</th><th style="text-align:left">Fallback</th><th style="text-align:left">Swap</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Chrome 35+</strong></td><td style="text-align:left">3 seconds</td><td style="text-align:left">Yes</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left"><strong>Opera</strong></td><td style="text-align:left">3 seconds</td><td style="text-align:left">Yes</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left"><strong>Firefox</strong></td><td style="text-align:left">3 seconds</td><td style="text-align:left">Yes</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left"><strong>Internet Explorer</strong></td><td style="text-align:left">0 seconds</td><td style="text-align:left">Yes</td><td style="text-align:left">Yes</td></tr><tr><td style="text-align:left"><strong>Safari</strong></td><td style="text-align:left">No timeout</td><td style="text-align:left">N/A</td><td style="text-align:left">N/A</td></tr></tbody></table><ul><li><p>Chrome 和 Firefox 超时时间为 3 秒，超时后使用后备字体。若字体最终勉强加载成功，它将替换后备字体，重新渲染文本。</p></li><li><p>IE 浏览器超时时间为 0 秒，也就是说，会立即渲染文本。若所请求的字体尚不可用，则使用后备字体。一旦请求字体可用，将重新渲染文本。</p></li><li><p>Safari 没有超时行为（或者说，至少在基准网络超时之前什么也没干）。</p></li></ul><p>更糟糕的是，这些规则对应用造成的影响，在很大程度上不受开发者控制。关注性能的开发者也许更乐意使用后备字体，使网页内容更快地展现，当更美观的 Web Font 下载完成后再加以使用。使用 Font Loading API 之类的工具，可以覆盖浏览器的某些默认行为，提升性能。但这将引入额外的 JavaScript 代码 —— 要么把代码内联到页面中；要么请求外部文件，而这可能带来额外的 HTTP 延时。</p><p>CSS 工作组为此提出了新方案：为<textarea width="0" height="0" class="codespan" style="display:none;">@font-face</textarea>增加新的<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>声明，用于控制字体下载完成之前的渲染行为。</p><h2 id="-">字体下载时间轴</h2><p>与一些浏览器目前使用的字体超时行为类似，<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>将字体下载过程划分为三个阶段。</p><ol><li><p>首先是字体阻塞阶段（font block period）。在此期间，如果字体未完成加载，则尝试使用它的任何元素必须以不可见的后备字体形式呈现；否则正常使用该字体。</p></li><li><p>紧接着字体阻塞阶段的是字体交换阶段（font swap period）。在此期间，如果字体未完成加载，则尝试使用它的任何元素必须使用后备字体进行渲染；否则正常使用该字体。</p></li><li><p>紧接着是字体故障阶段（font failure period）。此时若字体未完成加载，则将其标记为下载失败，并使用常规后备字体；否则正常使用该字体。</p></li></ol><p>理解以上三个阶段，根据字体是否下载成功、何时下载完成等情况，就可以可以使用<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>来决定如何渲染字体了。</p><h2 id="-font-display-">使用哪种 font-display 值？</h2><p>要使用<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>，请在<textarea width="0" height="0" class="codespan" style="display:none;">@font-face</textarea>规则中添加代码：</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-css&quot;&gt;%40%3Cspan%20class%3D%22hljs-keyword%22%3Efont-face%3C%2Fspan%3E%20%7B%0A%20%20%3Cspan%20class%3D%22hljs-attribute%22%3Efont-family%3C%2Fspan%3E%3A%20%20%3Cspan%20class%3D%22hljs-string%22%3E'Arvo'%3C%2Fspan%3E%3B%0A%20%20%3Cspan%20class%3D%22hljs-attribute%22%3Efont-display%3C%2Fspan%3E%3A%20%20auto%3B%0A%20%20%3Cspan%20class%3D%22hljs-attribute%22%3Esrc%3C%2Fspan%3E%3A%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Elocal%3C%2Fspan%3E(%3Cspan%20class%3D%22hljs-string%22%3E'Arvo'%3C%2Fspan%3E)%2C%20%3Cspan%20class%3D%22hljs-built_in%22%3Eurl%3C%2Fspan%3E(https%3A%2F%2Ffonts.gstatic.com%2Fs%2Farvo%2Fv9%2FrC7kKhY-eUDY-ucISTIf5PesZW2xOQ-xsNqO47m55DA.woff2)%20%3Cspan%20class%3D%22hljs-built_in%22%3Eformat%3C%2Fspan%3E(%3Cspan%20class%3D%22hljs-string%22%3E'woff2'%3C%2Fspan%3E)%3B%0A%7D&lt;/code&gt;</textarea><p>目前，<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>支持<textarea width="0" height="0" class="codespan" style="display:none;">auto | block | swap | fallback | optional</textarea>五种值。</p><h3 id="auto">auto</h3><p><textarea width="0" height="0" class="codespan" style="display:none;">auto</textarea>使用的字体展示策略与浏览器一致。当前，大多数浏览器使用的默认策略类似<textarea width="0" height="0" class="codespan" style="display:none;">block</textarea>。</p><h3 id="block">block</h3><p><textarea width="0" height="0" class="codespan" style="display:none;">block</textarea>给予字体一个较短的阻塞时间（大多数情况下推荐使用 3s）和无限大的交换时间。换言之，如果字体未加载完成，浏览器将首先绘制“隐形”文本；一旦字体加载完成，立即切换字体。为此，浏览器将创建一个匿名字体，其类型与所选字体相似，但所有字形都不含“墨水”。使用特定字体渲染文本之后页面方才可用，只有这种情况下才应该使用 <textarea width="0" height="0" class="codespan" style="display:none;">block</textarea>。</p><h3 id="swap">swap</h3><p>使用 <textarea width="0" height="0" class="codespan" style="display:none;">swap</textarea>，则阻塞阶段时间为 0，交换阶段时间无限大。也就是说，如果字体没有完成加载，浏览器会立即绘制文字，一旦字体加载成功，立即切换字体。与 <textarea width="0" height="0" class="codespan" style="display:none;">block</textarea> 类似，如果使用特定字体渲染文本对页面很重要，且使用其他字体渲染仍将显示正确的信息，才应使用 <textarea width="0" height="0" class="codespan" style="display:none;">swap</textarea>。Logo 文字就很适合使用 <textarea width="0" height="0" class="codespan" style="display:none;">swap</textarea>，因为以合理的后备字体显示公司名称仍将正确传递信息，而且最终会以官方字体的样式展现。</p><h3 id="fallback">fallback</h3><p>使用 <textarea width="0" height="0" class="codespan" style="display:none;">fallback</textarea>时，阻塞阶段时间将非常小（多数情况下推荐小于 100ms），交换阶段也比较短（多数情况下建议使用 3 秒钟）。换言之，如果字体没有加载，则首先会使用后备字体渲染。一旦加载成功，就会切换字体。但如果等待时间过久，则页面将一直使用后备字体。如果希望用户尽快开始阅读，而且不因新字体的载入导致文本样式发生变动而干扰用户体验，<textarea width="0" height="0" class="codespan" style="display:none;">fallback</textarea> 是一个很好的选择。举个例子，正文文本就符合这个条件。</p><h3 id="optional">optional</h3><p>使用 optional 时，阻塞阶段时间会非常小（多数情况下建议低于 100ms），交换阶段时间为 0。与 <textarea width="0" height="0" class="codespan" style="display:none;">fallback</textarea> 类似，如果字体能够为页面效果增色不少，但并非特别重要时，使用 <textarea width="0" height="0" class="codespan" style="display:none;">optional</textarea> 正好。使用 <textarea width="0" height="0" class="codespan" style="display:none;">optional</textarea> 时，将由浏览器来决定是否开始下载字体。可以不下载，也可以给予字体较低的优先级，一切取决于浏览器是否认为对用户最有利。当用户处于弱网络下，这是非常有用的，下载字体可能并非对资源最好的利用。</p><h2 id="-">浏览器支持</h2><p>启用 Chrome 49 桌面版、Opera 或 Opera for Android的 “Experimental Web Platform Features flag” 后可以使用 <textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>。（译者注：该文发表于 2016 年。根据译者 2017 年 8 月 4 日访问<a href="http://caniuse.com/#search=font-display" target="_blank">caniuse</a>获取的信息，Chrome 60 正式引入 <textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>。）</p><h2 id="demo">Demo</h2><p>点击<a href="https://jsbin.com/nigahi/latest/edit?html,output" target="_blank">链接</a>可以查看<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea>的效果。对关注性能的开发者来说，<textarea width="0" height="0" class="codespan" style="display:none;">font-display</textarea> 可是相当有用的工具啊！</p></div></article><nav class="pagination"><a href="/post/es2015-arraybuffer" title="ArrayBuffer and TypedArray in ES2015" class="prev">« ArrayBuffer and TypedArray in ES2015</a><a href="/post/event-delegation-pattern-or-anti-pattern" title="[译] 事件代理：模式 or 反模式？" class="next">[译] 事件代理：模式 or 反模式？ »</a></nav><div></div></div><footer id="footer" class="inner">
      © 2018 -  文蔺的博客
      <span> - </span><a href="/" class="nuxt-link-active">www.wemlion.com</a><br>
      Powered by <a target="_blank" href="https://nuxtjs.org">Nuxt.js</a> &amp; <a target="_blank" rel="nofollow" href="https://firekylin.org" class="external">FireKylin</a></footer></div></div></div></div><script type="text/javascript">window.__NUXT__={"layout":"default","data":[{}],"error":null,"serverRendered":true};</script><script src="/static/manifest.4f625a5f.js" defer></script><script src="/static/0-cf2867bf.js" defer></script><script src="/static/65-40990bcb.js" defer></script><script src="/static/common.d774ec7b.js" defer></script><script src="/static/app.ff62209b.js" defer></script>
  </body>
</html>

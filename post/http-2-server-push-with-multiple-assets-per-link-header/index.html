<!DOCTYPE html>
<html data-n-head-ssr data-n-head="">
  <head>
    <meta data-n-head="true" charset="utf-8"/><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/><meta data-n-head="true" name="description" content="文蔺的前端学习记录，国外技术文章翻译，个人学习心得等等这些都会记录在这里。"/><meta data-n-head="true" name="keywords" content="翻译,HTTP2,Server Push"/><meta data-n-head="true" name="description" content="HTTP2 Server Push 实践：单 Link  报头包含多资源场景"/><title data-n-head="true">[译] HTTP2 Server Push 实践：单 Link  报头包含多资源场景 | 文蔺的博客</title><link data-n-head="true" rel="favicon" href="/favicon.ico"/><link rel="stylesheet" href="/static/common.5ad111a3.css"><style data-vue-ssr-id="645210e9:0">#__layout,#__nuxt,.wrapper{width:100%;height:100%}.main{height:100%}.main>article,.main>div,.main>section{min-height:100%;margin-bottom:-81px}.main>article:after,.main>div:after,.main>section:after{display:block;content:"";height:81px}.main>article,.main>div,.main>section{border-bottom:0}.main>#footer{position:relative;z-index:1;border-top:0}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><div class="nuxt-progress" style="width:0%;height:2px;background-color:black;opacity:0;"></div><div id="__layout"><div class="wrapper"><nav id="sidebar" class="behavior_1"><div class="wrap"><div class="profile"><a href="/" class="nuxt-link-active"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a><span>文蔺的博客</span></div><ul class="buttons"><li><a href="/" title="主页" class="nuxt-link-active"><i class="iconfont icon-home"></i><span> 主页</span></a></li><li><a href="/archives" title="归档"><i class="iconfont icon-archive"></i><span> 归档</span></a></li><li><a href="/tags" title="标签"><i class="iconfont icon-tags"></i><span> 标签</span></a></li><li><a href="/about" title="关于"><i class="iconfont icon-user"></i><span> 关于</span></a></li><li><a href="/link" title="关注"><i class="iconfont icon-link"></i><span> 关注</span></a></li><li><a href="/collection" title="收藏"><i class="iconfont icon-archive"></i><span> 收藏</span></a></li></ul></div><ul class="buttons"><li><a href="https://github.com/AngusFu/" rel="nofollow" target="_blank" class="inline"><i title="GitHub" class="iconfont icon-github-v"></i></a><!----><!----><a href="/atom.xml" target="_blank" class="inline"><i title="RSS" class="iconfont icon-rss-v"></i></a><a href="/search" class="inline"><i title="Search" class="iconfont icon-search"></i></a></li></ul></nav><div id="header"><div class="btn-bar"><i></i></div><h1><a href="/" class="nuxt-link-active">文蔺的博客</a></h1><a href="/about/" class="me"><img src="/imgs/avatar.jpg" alt="文蔺的博客"></a></div><div id="sidebar-mask" style="display:none;"></div><div id="main" class="main"><div id="page-post"><article class="post detail"><div class="meta"><div class="date">2016-07-17</div></div><h1 class="title">[译] HTTP2 Server Push 实践：单 Link  报头包含多资源场景</h1><div class="entry-content"><blockquote><p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
        原文作者: <a href="https://blog.cloudflare.com/author/john-graham-cumming/" target="_blank">John Graham-Cumming</a><br>
        原文地址: <a href="https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/">https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/</a><br>
        译文地址: <a href="http://www.wemlion.com/post/http-2-server-push-with-multiple-assets-per-link-header">http://www.wemlion.com/post/http-2-server-push-with-multiple-assets-per-link-header</a><br>
        本文由 <a href="http://www.wemlion.com">文蔺</a> 翻译，转载请保留此声明。<br>
        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。
        </p></blockquote><h2 id="-">译者注</h2><p>译者在做自己的一个小工具（抓取博客的 Chrome 扩展）的时候，使用 jQuery 辅助作为 DOM 解析器，为了避免加载图片、脚本、样式表等无用的资源，在将字符串传给 <textarea width="0" height="0" class="codespan" style="display:none;">$</textarea> 的时候，先对字符串中的相关标签进行了处理。</p><p>但遇到<a href="https://www.qianduan.net/" target="_blank">某个网站</a>的时候，一直疑惑不解，<strong>明明已经做了替换</strong>，但通过 Chrome Devtools 能看到，<strong>部分资源还是会下载</strong>。几经折腾，发现还是因为自己<strong>懂得太少</strong>了。</p><p>查看请求该页面时的 header，可以看到了如下信息：</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-javascript&quot;&gt;link%3A%3Cspan%20class%3D%22xml%22%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Eassets%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Ecss%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Escreen.css%3C%2Fspan%3E%3F%3Cspan%20class%3D%22hljs-attr%22%3Ev%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E5bb156d854%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dstyle%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Econtent%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimages%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E2015%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E10%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eavatar.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Econtent%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimages%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E2015%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E10%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eavatar.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Econtent%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimages%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E2015%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E10%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eavatar.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Econtent%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimages%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E2015%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E10%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eavatar.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Econtent%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimages%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E2015%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3E10%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eavatar.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%2F%3Cspan%20class%3D%22hljs-attr%22%3Ewww.qianduan.net%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimg%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Egive-me-five%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Exitu.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%2F%3Cspan%20class%3D%22hljs-attr%22%3Ewww.qianduan.net%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimg%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eapps%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eshinning.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%2F%3Cspan%20class%3D%22hljs-attr%22%3Ewww.qianduan.net%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimg%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eapps%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eshakeme.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%2F%3Cspan%20class%3D%22hljs-attr%22%3Ewww.qianduan.net%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eimg%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Egive-me-five%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eqianduan_wechat.jpg%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dimage%3C%2Fspan%3E&lt;/code&gt;</textarea><p>于是，大概能猜出来上述问题的原因。这有点类似如一些站点会使用的 <textarea width="0" height="0" class="codespan" style="display:none;">&lt;link rel=&quot;preload&quot; href=&quot;/styles/other.css&quot; as=&quot;style&quot;&gt;</textarea> 标签（顺带一句，截至 2016 年 7 月 17 日，<a href="http://caniuse.com/#search=preload" target="_blank">caniuse</a> 数据：China = 26.83%；Global = 44.59%）。</p><p>于是深入挖掘了一下。来看看 <a href="https://w3c.github.io/preload/#introduction" target="_blank">W3C 标准</a>是怎么说的（同样由译者翻译）：</p><p>例如，应用可以使用 preload 关键词，提前、高优先级、不阻塞渲染地拉取的 CSS 资源，它会在适当的时候被使用：</p><p>例一：使用标签</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-html&quot;&gt;%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E9%80%9A%E8%BF%87%E5%A3%B0%E6%98%8E%E6%A0%87%E7%AD%BE%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%A0%B7%E5%BC%8F%E8%A1%A8%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Elink%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Erel%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22preload%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Ehref%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22%2Fstyles%2Fother.css%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Eas%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22style%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E6%88%96%E8%80%85%E9%80%9A%E8%BF%87%20JavaScript%20%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%A0%B7%E5%BC%8F%E8%A1%A8%20%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22javascript%22%3E%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Evar%3C%2Fspan%3E%20res%20%3D%20%3Cspan%20class%3D%22hljs-built_in%22%3Edocument%3C%2Fspan%3E.createElement(%3Cspan%20class%3D%22hljs-string%22%3E%22link%22%3C%2Fspan%3E)%3B%0A%20%20%20%20res.rel%20%3D%20%3Cspan%20class%3D%22hljs-string%22%3E%22preload%22%3C%2Fspan%3E%3B%0A%20%20%20%20res.as%20%3D%20%3Cspan%20class%3D%22hljs-string%22%3E%22style%22%3C%2Fspan%3E%3B%0A%20%20%20%20res.href%20%3D%20%3Cspan%20class%3D%22hljs-string%22%3E%22styles%2Fother.css%22%3C%2Fspan%3E%3B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Edocument%3C%2Fspan%3E.head.appendChild(res)%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E&lt;/code&gt;</textarea><p>例二：使用  HTTP Header</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-javascript&quot;&gt;Link%3A%20%3Cspan%20class%3D%22xml%22%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Ehttps%3A%3C%2Fspan%3E%2F%2F%3Cspan%20class%3D%22hljs-attr%22%3Eexample.com%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Eother%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Estyles.css%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dstyle%3C%2Fspan%3E&lt;/code&gt;</textarea><p>上面的例子说明，资源可以通过声明性标记、HTTP header link 来指定，或者使用 JavaScript 预定。</p><p>记录以下资源备忘：</p><ul><li><p><a href="https://w3c.github.io/preload/" target="_blank">https://w3c.github.io/preload/</a></p></li><li><p><a href="http://caniuse.com/#search=preload" target="_blank">http://caniuse.com/#search=preload</a></p></li><li><p><a href="http://stackoverflow.com/questions/36641137/how-exactly-does-link-rel-preload-work" target="_blank">http://stackoverflow.com/questions/36641137/how-exactly-does-link-rel-preload-work</a></p></li><li><p><a href="https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/?" target="_blank">https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/</a>（也就是本文）</p></li></ul><p>译文标题为意译，原标题为 <textarea width="0" height="0" class="codespan" style="display:none;">HTTP/2 Server Push with multiple assets per Link header</textarea>，恐有不当，特此说明。</p><p>另，为加强理解 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头与 <textarea width="0" height="0" class="codespan" style="display:none;">HTTP/2 Server Push</textarea> 二者，译文正文后附有 W3C preload 标准中 <a href="https://w3c.github.io/preload/#server-push-http-2" target="_blank">“Server Push (HTTP/2)”</a> 一节译文。或有助于读懂本文。</p><font style="color:red;"><strong>注： 译文中凡是 “link 响应头” 的名词，英文为 “Link header”，翻译为“响应头 Link 字段”或许更恰当。</strong></font><h2 id="-">正文</h2><p>四月份的时候，我们<a href="https://blog.cloudflare.com/announcing-support-for-http-2-server-push-2/" target="_blank">宣布</a>为所有的 CloudFlare  网站添加了 <a href="https://www.cloudflare.com/http2/server-push/" target="_blank">HTTP/2 Server Push</a> 试验性支持。这样做是为了让客户能够在该新功能的基础上进行迭代。</p><p><img alt=""></p><p><small><a href="https://creativecommons.org/licenses/by/2.0/" target="_blank">CC BY 2.0</a><a href="https://www.flickr.com/photos/mryipyop/1673801831/in/photolist-3xUEYg-nMS6rx-jvSsLx-9oBV3s-8KH2YK-o54g8R-8h4bmw-eapSfS-cj4No3-nMSXLP-nMRZQJ-iNpH9k-hcr3m3-nMS6ui-5RDVrK-fAaYES-nMXwba-cNFT3N-iZDTWg-k5VzKt-jeJE8T-7bM32E-d3rznG-89jZ9e-aVLkBT-4y2kdD-qtKzjY-62Yv2h-5WcKeC-87jJdA-5Es3vn-bQ8W5a-7DhbKd-hE5oza-6NutL7-5WLwFt-hcnrny-5WAoU1-5mSoVV-8RSQ7A-gXiVcG-5Wp6pS-8GFkMr-hcoeN9-bC1zH5-ePG8BQ-hcokfv-hcpgme-hcqQ59-qUkfTa" target="_blank">image</a> by <a href="https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header/Mike" target="_blank">https://www.flickr.com/photos/mryipyop/</a></small></p><p>我们的 Server Push 实现，利用了 <a href="https://blog.cloudflare.com/announcing-support-for-http-2-server-push-2/#fnref:1" target="_blank">HTTP <textarea width="0" height="0" class="codespan" style="display:none;">Link</textarea></a> 报头，这在 W3C <a href="https://www.w3.org/TR/preload/" target="_blank">Preload</a> 工作草案中有详细描述。</p><p>同样，我们还展示了，如何在 <a href="https://blog.cloudflare.com/using-http-2-server-push-with-php/" target="_blank">PHP 代码</a> 中实现 Server Push，许多人已经开始测试、使用该特性了。</p><p>然而，我们的初始版本有很严格的限制：使用 Server Push，则每个 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头中，最多只能指定一个资源，另外，很多 CMS 和 Web 开发平台都不允许存在多个 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头。</p><p>现在该问题已得到解决，多个资源可以通过单个 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头推送。修改是实时生效的，如果你的浏览器支持 HTTP/2 的话，你正在阅读的本文就使用了该方式推送资源。</p><p>当 CloudFlare 读到源服务器（origin web server）的 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头时，它从中移除其中已通过 Server Push 推送给浏览器的资源。这样一来，要 debug <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 和 Server Push 问题就困难了，所以我们又加上了一个叫做 <textarea width="0" height="0" class="codespan" style="display:none;">Cf-H2-Pushed</textarea> 的报头，它包含已经推送过的资源。</p><p>举个例子。打开最近的<a href="https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/" target="_blank">这篇博客</a>，源服务器就会发送以下报头：</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-javascript&quot;&gt;Cache-Control%3A%20public%2C%20max-age%3D%3Cspan%20class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0AContent-Encoding%3A%20gzip%0AContent-Length%3A%20%3Cspan%20class%3D%22hljs-number%22%3E33640%3C%2Fspan%3E%0AContent-Type%3A%20text%2Fhtml%3B%20charset%3Dutf%3Cspan%20class%3D%22hljs-number%22%3E-8%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-built_in%22%3EDate%3C%2Fspan%3E%3A%20Wed%2C%20%3Cspan%20class%3D%22hljs-number%22%3E29%3C%2Fspan%3E%20Jun%20%3Cspan%20class%3D%22hljs-number%22%3E2016%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-number%22%3E16%3C%2Fspan%3E%3A%3Cspan%20class%3D%22hljs-number%22%3E09%3C%2Fspan%3E%3A%3Cspan%20class%3D%22hljs-number%22%3E37%3C%2Fspan%3E%20GMT%0AExpires%3A%20Wed%2C%20%3Cspan%20class%3D%22hljs-number%22%3E29%3C%2Fspan%3E%20Jun%20%3Cspan%20class%3D%22hljs-number%22%3E2016%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-number%22%3E16%3C%2Fspan%3E%3A%3Cspan%20class%3D%22hljs-number%22%3E10%3C%2Fspan%3E%3A%3Cspan%20class%3D%22hljs-number%22%3E07%3C%2Fspan%3E%20GMT%0ALink%3A%20%26lt%3B%2Fassets%2Fcss%2Fscreen.css%3Fv%3D5fc240c512%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dstyle%2C%26lt%3B%2F%2Fcdn.bizible.com%2Fscripts%2Fbizible.js%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%2C%26lt%3B%2Fcontent%2Fimages%2F2016%2F06%2FTimeouts-001.png%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%26lt%3B%2Fcontent%2Fimages%2F2016%2F06%2FTimeouts-002.png%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dimage%2C%26lt%3B%2F%2Fplatform.linkedin.com%2Fin.js%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%2C%26lt%3Bhttps%3A%2F%2Fcode.jquery.com%2Fjquery-1.11.3.min.js%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%2C%26lt%3B%2Fassets%2Fjs%2Fjquery.fitvids.js%3Fv%3D5fc240c512%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%0AVary%3A%20Accept-Encoding%0AX-Ghost-Cache-Status%3AFrom%20Cache%0AX-Powered-By%3A%20Express&lt;/code&gt;</textarea><p>CloudFlare 决定使用使用 HTTP/2 Server Push 推送这些资源：</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-javascript&quot;&gt;%3Cspan%20class%3D%22hljs-string%22%3E%60%2Fassets%2Fcss%2Fscreen.css%3Fv%3D5fc240c512%60%3C%2Fspan%3E%2C%0A%3Cspan%20class%3D%22hljs-string%22%3E%60%2Fcontent%2Fimages%2F2016%2F06%2FTimeouts-001.png%60%3C%2Fspan%3E%2C%0A%3Cspan%20class%3D%22hljs-string%22%3E%60%2Fcontent%2Fimages%2F2016%2F06%2FTimeouts-002.png%60%3C%2Fspan%3E%2C%0A%3Cspan%20class%3D%22hljs-string%22%3E%60%2Fassets%2Fjs%2Fjquery.fitvids.js%3Fv%3D5fc240c512%60%3C%2Fspan%3E&lt;/code&gt;</textarea><p>响应通过 CloudFlare 的时候，这些资源将从 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头终移除，通过 Server Push 推送，并被添加到 <textarea width="0" height="0" class="codespan" style="display:none;">Cf-H2-Pushed</textarea> 报头中：</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-javascript&quot;&gt;cache-control%3Apublic%2C%20max-age%3D%3Cspan%20class%3D%22hljs-number%22%3E30%3C%2Fspan%3E%0Acf-cache-status%3AEXPIRED%0Acf-h2-pushed%3A%26lt%3B%2Fassets%2Fcss%2Fscreen.css%3Fv%3D5fc240c512%26gt%3B%2C%26lt%3B%2Fcontent%2Fimages%2F2016%2F06%2FTimeouts-001.png%26gt%3B%2C%26lt%3B%2Fcontent%2Fimages%2F2016%2F06%2FTimeouts-002.png%26gt%3B%2C%26lt%3B%2Fassets%2Fjs%2Fjquery.fitvids.js%3Fv%3D5fc240c512%26gt%3B%0Acontent-encoding%3Agzip%0Acontent-type%3Atext%2Fhtml%3B%20charset%3Dutf-8%0Adate%3AWed%2C%2029%20Jun%202016%2016%3A09%3A37%20GMT%0Aexpires%3AWed%2C%2029%20Jun%202016%2016%3A10%3A07%20GMT%0Alink%3A%26lt%3B%2F%2Fcdn.bizible.com%2Fscripts%2Fbizible.js%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%2C%26lt%3B%2F%2Fplatform.linkedin.com%2Fin.js%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%2C%26lt%3Bhttps%3A%2F%2Fcode.jquery.com%2Fjquery-1.11.3.min.js%26gt%3B%3B%20rel%3Dpreload%3B%20as%3Dscript%0Aserver%3Acloudflare-nginx%0Astatus%3A200%20OK%0Avary%3AAccept-Encoding%0Ax-ghost-cache-status%3AFrom%20Cache%0Ax-powered-by%3AExpress&lt;/code&gt;</textarea><p>在 Google Chrome 金丝雀版本（Google Chrome Canary）的开发者视图中可以看得很清楚。（译者注：翻译本文时译者使用的 Chrome 51.0.2704.106 m (64-bit) 确实无法看到 Push 信息，建议使用最新金丝雀版本一探究竟。）</p><p><img alt=""></p><h3 id="-">结尾</h3><p>如果你在使用  Server Push，请和我们联系。推送不同类型的资源（图片 vs 样式表 vs 脚本）、解决最佳的推送数量（目前我们支持 每页最多 50 条资源），我们对相关经验十分感兴趣。</p><h2 id="-server-push-http-2-">附： Server Push (HTTP/2)</h2><p>原文地址： <a href="https://w3c.github.io/preload/#server-push-http-2" target="_blank">https://w3c.github.io/preload/#server-push-http-2</a></p><p>HTTP/2 ([<a href="https://w3c.github.io/preload/#bib-RFC7540" target="_blank">RFC7540</a>]) 允许服务器先发制人地向客户端发送（“推送”）响应。推送的响应（pushed response）在语义上（semantically）与服务器对请求的响应（server responding to a request）是等价的，而且类似于预加载的响应（preloaded response）；它会被浏览器保存，在<a href="https://w3c.github.io/preload/#dfn-match-a-preloaded-response" target="_blank">匹配到应用启动的其他请求</a>的时候被执行。像这样的，从应用角度来看，使用预加载和服务器推送的请求，并无差别。</p><p>服务器<em>可能</em>会为应用定义的那些有权限的 <a href="https://w3c.github.io/preload/#dfn-preload-link" target="_blank">preload link</a> 资源启用服务器推送。对那些声明的 <a href="https://w3c.github.io/preload/#dfn-preload-link" target="_blank">preload link</a> 资源来说，启用服务器推送消除了客户端和服务器之间的请求往返。可选地，如果某个通过 <textarea width="0" height="0" class="codespan" style="display:none;">link</textarea> 报头(<a href="https://w3c.github.io/preload/#bib-RFC5988" target="_blank">RFC5988</a>)声明的资源不希望使用服务器推送，开发者*可以使用 <textarea width="0" height="0" class="codespan" style="display:none;">nopush</textarea> 目标属性(<a href="https://w3c.github.io/preload/#bib-RFC5988" target="_blank">RFC5988</a>] section 5.4) 向服务器提供一个选择性退出的信号。示例如下：</p><p>例三</p><textarea width="0" height="0" class="pre-area" style="display:none;">&lt;code class=&quot;hljs lang-javascript&quot;&gt;Link%3A%20%3Cspan%20class%3D%22xml%22%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Eapp%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Estyle.css%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dstyle%3B%20nopush%0ALink%3A%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Eapp%3C%2Fspan%3E%2F%3Cspan%20class%3D%22hljs-attr%22%3Escript.js%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3B%20rel%3Dpreload%3B%20as%3Dscript%3C%2Fspan%3E&lt;/code&gt;</textarea><p>Note：上面的示例，向一个可以使用 HTTP/2 推送的服务器提示， <textarea width="0" height="0" class="codespan" style="display:none;">/app/style.css</textarea> 不应被推送（例如，来源方可能有额外信息显示其已经存在于缓存中），而  <textarea width="0" height="0" class="codespan" style="display:none;">/app/script.js</textarea> 应当可以作为服务器推送的候选资源。</p><p>为 <a href="https://w3c.github.io/preload/#dfn-preload-link" target="_blank">preload link</a> 启用服务器推送是一个可选的优化项。比方说，服务器可能不会启用推送，如果它认为响应在客户端缓存中可以拿到：客户端会处理预加载指令，检查相关缓存，如果找不到资源则会发送请求。另外，服务器可能因为运维问题而不会启用推送，比如说可用服务器资源或者其他考量。最后，服务器推送的启用取决于协议的 HTTP/2 连接设置：客户端可能会限制或完全禁用服务器推送的使用。应用程序不应当依赖于服务器推送的可用性及其使用。</p></div></article><nav class="pagination"><a href="/post/9-innovations-that-could-become-the-next-big-thing" title="[译] 盘点即将影响世界的九大创新" class="prev">« [译] 盘点即将影响世界的九大创新</a><a href="/post/hybrid-or-native-mobile-app-use-the-right-tool-for-the-job" title="[译] Hybrid or Native： 适合工作的才是最好的" class="next">[译] Hybrid or Native： 适合工作的才是最好的 »</a></nav><div></div></div><footer id="footer" class="inner">
      © 2018 -  文蔺的博客
      <span> - </span><a href="/" class="nuxt-link-active">www.wemlion.com</a><br>
      Powered by <a target="_blank" href="https://nuxtjs.org">Nuxt.js</a> &amp; <a target="_blank" rel="nofollow" href="https://firekylin.org" class="external">FireKylin</a></footer></div></div></div></div><script type="text/javascript">window.__NUXT__={"layout":"default","data":[{}],"error":null,"serverRendered":true};</script><script src="/static/manifest.4f625a5f.js" defer></script><script src="/static/0-cf2867bf.js" defer></script><script src="/static/58-bcc3b3c4.js" defer></script><script src="/static/common.d774ec7b.js" defer></script><script src="/static/app.ff62209b.js" defer></script>
  </body>
</html>

webpackJsonp([29],{"+Ddb":function(s,a,t){"use strict";var e=function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{attrs:{id:"page-post"}},[t("article",{staticClass:"post detail"},[t("div",{staticClass:"meta"},[t("div",{staticClass:"date"},[s._v(s._s(s.post.create_time))])]),t("h1",{staticClass:"title"},[s._v(s._s(s.post.title))]),t("div",{staticClass:"entry-content"},[s.post.translation?t("blockquote",[t("p",{staticStyle:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[s._v("\n        原文作者: "),t("a",{attrs:{href:s.post.translation.social,target:"_blank"}},[s._v(s._s(s.post.translation.author))]),t("br"),s._v("\n        原文地址: "),t("a",{attrs:{href:s.post.translation.from}},[s._v(s._s(s.post.translation.from))]),t("br"),s._v("\n        译文地址: "),t("a",{attrs:{href:s.post_url}},[s._v(s._s(s.post_url))]),t("br"),s._v("\n        本文由 "),t("a",{attrs:{href:this.$config.site_url}},[s._v(s._s(this.$config.site_owner))]),s._v(" 翻译，转载请保留此声明。"),t("br"),s._v("\n        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。\n        ")])]):s._e(),t("h2",{attrs:{id:"2016-09-03-"}},[s._v("2016-09-03 更新")]),t("p",[s._v("随着在工作学习中更多地接触、使用测试工具，发现自己在本文中的一些记录是不准确、不正确的。")]),t("p",[s._v("今天（九月三日）在家看了 NingJs 的直播，其中有一个分享是关于测试框架的，非常棒，之后有可能的话还是找来视频再学习下。")]),t("p",[s._v("是的，两个月前的理解，是很初级很浅陋的。")]),t("p",[s._v("继续学习，继续钻研吧。")]),t("h2",{attrs:{id:"-"}},[s._v("交代前因")]),t("p",[s._v("前些天接手了一个旧项目。幸好不是在原来的基础上做些修修改改的工作，可以算是开发新版的。")]),t("p",[s._v("把前面同事留下来的代码 down 下来，看了一下。总体还是挺好的。还有 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("macha + chai")]),s._v(" 的测试目录。")]),t("p",[s._v("我也是最近一段时间开始接触测试。很久之前看了阮大神写的 mocha 教程，不过也就看看，写写简单的 demo。")]),t("p",[s._v("前同事留下的测试，是基于浏览器的，主要还是功能测试。这里不详细说怎么在浏览器端使用 mocha 测试了。因为涉及到交互的反馈、追踪，所以采用的方式是，先用 iframe 加载待测页面，然后用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("contentWindow")]),s._v(" 的方式拿到 iframe 的环境，再做一些操作。手动触发一些功能，然后再去判断相应的变化有没有发生。")]),t("p",[s._v("本地启动了一个 server，浏览器里跑了几遍测试。最后发现的问题是，有一个点击测试怎么都过不了。于是又开启了阅读代码的过程。")]),t("p",[s._v("最后发现了问题所在，页面使用的是自己封装的 tap 事件，整个事件系统也是对原生 Element 原型的拓展。可是怎么触发 tap 呢？前同事用了 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("touchend")]),s._v("。可是并没有用啊， tap 事件的触发可是结合了从 touchstart 开启一系列事件参数的判断的。")]),t("p",[s._v("后来我就想，浏览器端功能测试，能不能也拿到命令行上面来呢？")]),t("h2",{attrs:{id:"-mocha-ava"}},[s._v("从 mocha 转到 ava")]),t("p",[s._v("正在此时，我想起了 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("jsdom")]),s._v(" 这个大神级作品。")]),t("p",[s._v("一开始打算用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("mocha + jsdom")]),s._v(" 跑一把。"),t("del",[s._v("折腾了几次发现，mocha 这家伙不好适应异步的工作，这事情很难搞啊。")])]),t("p",[s._v("可能要交代下我做了什么，嗯，我加载了一个 jquery 脚本，这样就得外部文件，于是就有异步场景了。试了好多遍，mocha 还是没能实现我的期望。（你也可以拿 mocha 试试看，多试几次，如果单纯靠那个 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("done")]),s._v(" 你就能成功，那么请私信我哟。）")]),t("p",[s._v("又想想白天乱逛 github 的时候，在一些个项目中看到了 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("ava")]),s._v(" 这个测试工具。搜索一番，据说正适用于异步场景。")]),t("p",[s._v("好，那就来试试看呗。前因交代清楚了，下面开始正式进入教程阶段。")]),t("h2",{attrs:{id:"-demo"}},[s._v("开始讲 demo")]),s._m(0),t("p",[s._v("因为是 demo，项目内容很简单，两个 js，一个用于测试 html 文件。")]),t("h2",{attrs:{id:"-"}},[s._v("测试场景")]),t("p",[s._v("先说测试场景：页面上有一个红色背景的 div，通过原生的 addEventListener 绑定了 click 事件。点击之后，将背景色变换为绿色。就酱简单？对，主要就这个，一方面我是想测试下 jsdom 对事件系统和 css 解析的支持（手动触发事件，css 解析和值变化），一方面是想试试这种异步场景下怎么更好地测试。")]),t("p",[s._v("那些对测试脚本运行速度有非常严格要求的同学请想好了再往后看。因为根据我的经验，jsdom + ava 这俩组合起来，速度确实慢得不行。我还没仔细探究原因，但想来无非以下几点：")]),s._m(1),t("p",[s._v("暂且忍着点。")]),t("p",[s._v("核心 html 如下：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-html\">%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Estyle%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22css%22%3E%0A%20%20%20%20%3Cspan%20class%3D%22hljs-selector-tag%22%3Ediv%3C%2Fspan%3E%20%7B%3Cspan%20class%3D%22hljs-attribute%22%3Ewidth%3C%2Fspan%3E%3A%20%3Cspan%20class%3D%22hljs-number%22%3E500px%3C%2Fspan%3E%3B%20%3Cspan%20class%3D%22hljs-attribute%22%3Eheight%3C%2Fspan%3E%3A%20%3Cspan%20class%3D%22hljs-number%22%3E500px%3C%2Fspan%3E%3B%20%3Cspan%20class%3D%22hljs-attribute%22%3Ebackground-color%3C%2Fspan%3E%3A%20red%3B%7D%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Estyle%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Ediv%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Eid%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22div%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Ediv%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22javascript%22%3E%0A%20%20%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Edocument%3C%2Fspan%3E.getElementById(%3Cspan%20class%3D%22hljs-string%22%3E%22div%22%3C%2Fspan%3E).onclick%20%3D%20%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E%20(%3Cspan%20class%3D%22hljs-params%22%3E%3C%2Fspan%3E)%20%3C%2Fspan%3E%7B%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.style.backgroundColor%20%3D%20%3Cspan%20class%3D%22hljs-string%22%3E'green'%3C%2Fspan%3E%3B%0A%20%20%20%20%7D%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>")]),t("h2",{attrs:{id:"-"}},[s._v("测试工具安装")]),t("p",[s._v("下面来谈工具的安装。")]),t("p",[s._v("首先安装 jsdom，这倒是很简单：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-bash">%24%20npm%20install%20--save%20jsdom</code>')]),t("p",[s._v("接着安装 ava，最好先全局安装一遍：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-bash">%0A%24%20npm%20install%20-g%20ava%0A%0A%24%20npm%20install%20--save%20ava</code>')]),t("p",[s._v("然后为了方便使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("npm test")]),s._v(" 命令，执行下面的命令：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-bash">%24%20ava%20--init</code>')]),t("p",[s._v("这一行的目的是将 ava 命令放到你的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("package.json")]),s._v(" 中的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("scripts")]),s._v(" 字段中，方便之后使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("npm test")]),s._v(" 直接开启跑测试。当然你也可以不管这一步，我就比较喜欢自己敲 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("ava xx.js")]),s._v(" 这样子。")]),t("h2",{attrs:{id:"-"}},[s._v("编写测试")]),t("p",[s._v("好了，环境安装完毕。下面来看脚本。")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20fs%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'fs'%3C%2Fspan%3E%3B%0A%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7B%20jsdom%20%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'jsdom'%3C%2Fspan%3E%3B%0A%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20test%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'ava'%3C%2Fspan%3E%3B</code>")]),t("p",[s._v("ava 在运行时会通过 babel 6 对测试脚本进行编译，因此完全可以自由发挥，generator、async & await 什么的都尽情地用吧。而且作者也是建议和支持这样做的，简单明了的测试脚本，重要性有时候可能和测试本身一样重要。")]),t("p",[s._v("引入 fs 是为了读取我们的 html 文件。")]),t("p",[s._v("关于 jsdom 的用法，更多的可以参考 "),t("a",{attrs:{href:"https://github.com/tmpvar/jsdom",target:"_blank"}},[s._v("https://github.com/tmpvar/jsdom")]),s._v("，看项目的文档。这里我使用的是简单易懂的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("require('jsdom').jsdom")]),s._v(" 形式，便于以同步的形式解析生成我们需要的 window 对象，如下：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%0A%3Cspan%20class%3D%22hljs-keyword%22%3Evar%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-built_in%22%3Ewindow%3C%2Fspan%3E%20%3D%20jsdom(fs.readFileSync(%3Cspan%20class%3D%22hljs-string%22%3E'.%2Ftest.html'%3C%2Fspan%3E)).defaultView%3B</code>")]),t("p",[s._v("一个挺好用的方法是 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("jsdom.jQueryify")]),s._v("，能向页面注入 jQuery。不过这是个异步的方法（废话），所以这里我使用了 Promise，也是为了方便之后使用 async & await 语法。")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-javascript">%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-title%22%3EjsdomTest%3C%2Fspan%3E(%3Cspan%20class%3D%22hljs-params%22%3E%3C%2Fspan%3E)%20%3C%2Fspan%3E%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-built_in%22%3EPromise%3C%2Fspan%3E(%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E%20(%3Cspan%20class%3D%22hljs-params%22%3Eresolve%2C%20reject%3C%2Fspan%3E)%20%3C%2Fspan%3E%7B%20%0A%20%20%20%20%20%20%20%20jsdom.jQueryify(%3Cspan%20class%3D%22hljs-built_in%22%3Ewindow%3C%2Fspan%3E%2C%20%3Cspan%20class%3D%22hljs-string%22%3E%22http%3A%2F%2Fapps.bdimg.com%2Flibs%2Fjquery%2F2.1.4%2Fjquery.js%22%3C%2Fspan%3E%2C%20%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E%20(%3Cspan%20class%3D%22hljs-params%22%3E%3C%2Fspan%3E)%20%3C%2Fspan%3E%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20resolve(%3Cspan%20class%3D%22hljs-built_in%22%3Ewindow%3C%2Fspan%3E.jQuery)%3B%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%7D</code>')]),t("p",[s._v("ava 的测试用例写起来也挺简单，来看代码：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%0Atest(%3Cspan%20class%3D%22hljs-string%22%3E'%E7%82%B9%E5%87%BB%E6%B5%8B%E8%AF%95'%3C%2Fspan%3E%2C%20%3Cspan%20class%3D%22hljs-keyword%22%3Easync%3C%2Fspan%3E%20t%20%3D%26gt%3B%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Evar%3C%2Fspan%3E%20%24%20%3D%20%3Cspan%20class%3D%22hljs-keyword%22%3Eawait%3C%2Fspan%3E%20jsdomTest()%3B%0A%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Evar%3C%2Fspan%3E%20%24div%20%3D%20%24(%3Cspan%20class%3D%22hljs-string%22%3E'%23div'%3C%2Fspan%3E)%3B%0A%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Evar%3C%2Fspan%3E%20colorBeforeClick%2C%20colorAfterClick%3B%0A%0A%20%20%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Econsole%3C%2Fspan%3E.log(colorBeforeClick%20%3D%20%24div.css(%3Cspan%20class%3D%22hljs-string%22%3E'background-color'%3C%2Fspan%3E))%3B%0A%0A%20%20%20%20%24div.trigger(%3Cspan%20class%3D%22hljs-string%22%3E'click'%3C%2Fspan%3E)%3B%0A%0A%20%20%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Econsole%3C%2Fspan%3E.log(colorAfterClick%20%3D%20%24div.css(%3Cspan%20class%3D%22hljs-string%22%3E'background-color'%3C%2Fspan%3E))%3B%0A%0A%20%20%20%20t.not(colorBeforeClick%2C%20colorAfterClick%2C%20%3Cspan%20class%3D%22hljs-string%22%3E'bgColor%20changed'%3C%2Fspan%3E)%3B%0A%7D)%3B</code>")]),t("p",[t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("test")]),s._v(" 的第一个参数是测试用例的名称，第二个参数是一个函数，该函数会注入 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("t")]),s._v(" 对象。我们所有的断言都是通过这个注入的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("t")]),s._v(" 进行的。")]),s._m(2),t("p",[s._v("来说上面的代码。首先我们使用的是 async & await 语法，整个看起来比回调函数嵌套要整洁许多，整个流程看起来也相对清楚。")]),t("p",[s._v("第一步是先等待 jQuery 注入成功，拿到 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("$")]),s._v("。其实这一步可有可无，我纯粹是为了测试 jsdom API，并且懒得手动写 dispatch 事件的代码才这么干的。")]),t("p",[s._v("接下来就开始 DOM 查询，然后先获取 div 当前的背景色并打印出来。接着手动触发 click 事件，然后再次获取 div 的背景色并打印。最后将触发点击前后的两个颜色值拿来对比。")]),t("p",[s._v("依葫芦画瓢，差不多就这么搞定了。")]),t("p",[s._v("打开命令行，进入工作目录，然后开始测试：")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-bash">%0A%24%20%20ava%20-v%20parallel.js</code>')]),t("p",[s._v("相信我，"),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("-v")]),s._v(" 参数可以让你的命令行界面显得比较安静一些。")]),t("p",[s._v("如果你想要使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("npm test")]),s._v(" 这样的命令来测试，请进一步阅读文档进行相关配置（将上面的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("ava")]),s._v(" 换成 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("nom test")]),s._v("是没用的哦）。这里主要还是为了简便。")]),t("h2",{attrs:{id:"-"}},[s._v("友情提示")]),t("p",[s._v("友情提示第二波：会不会怀疑，触发点击事件之后，颜色立马就变了？不存在延迟、异步么？答案是 yes，真的不存在。假如你和我一样在这里犹豫了，那么说明存在这样两种可能性：")]),s._m(3),t("p",[s._v("当时为了应对“潜在的异步”（啊我想到了迫害狂想症），我特意做了几百毫秒的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("setTimeout")]),s._v(" 延时。结果呢，断言的谓词（not、same、notSame等等）各种正向、反向都试了一遍，测试永远通过。什么鬼？说好的良好的异步支持呢？后来再去看文档，发现人家写得清清楚楚：")]),s._m(4),t("p",[s._v("所以，真的，认真读文档是很有必要的。")]),t("p",[s._v("真正遇到要延时的，怎么办？我想，Promise 会解救你的。")]),t("h2",{attrs:{id:"-"}},[s._v("并行与串行")]),t("p",[s._v("ava 声称是很高效的。通常情况下，同一个文件里测试都是并行的，并不一定按照顺序执行。")]),t("p",[s._v("还以上面的代码为例。为了测试一下，我选择了投机取巧。不是并行吗？那我就检测 jQuery 存不存在就不行了吗？因为我们的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("test")]),s._v(" 中，是异步加载 jQuery 的。所以如果测试是并行的，那么不一定能够检测到 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("window.$")]),s._v(" 的存在。")]),s._m(5),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%0Atest(%3Cspan%20class%3D%22hljs-string%22%3E'%E4%B8%B2%E8%A1%8C%E6%B5%8B%E8%AF%95'%3C%2Fspan%3E%2C%20%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E%20(%3Cspan%20class%3D%22hljs-params%22%3Et%3C%2Fspan%3E)%20%3C%2Fspan%3E%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Econsole%3C%2Fspan%3E.log(%3Cspan%20class%3D%22hljs-built_in%22%3Ewindow%3C%2Fspan%3E.%24)%0A%20%20%20%20t.true(!!%3Cspan%20class%3D%22hljs-built_in%22%3Ewindow%3C%2Fspan%3E.%24%2C%20%3Cspan%20class%3D%22hljs-string%22%3E'%E4%B8%B2%E8%A1%8C%E5%A4%B1%E8%B4%A5'%3C%2Fspan%3E)%3B%0A%7D)%3B</code>")]),t("p",[s._v("可是，如果我就要串行呢？")]),t("p",[s._v("还好作者也想到了这种情况。将所有的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("test")]),s._v(" 改成 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("test.serial")]),s._v(" 即可（见 "),t("a",{attrs:{href:"https://github.com/AngusFu/jsdom-ava-demo/blob/master/serial.js",target:"_blank"}},[s._v("serial.js")]),s._v("）。")]),t("p",[s._v("需要说明的是，所谓的串行执行，只是在同一个测试文件中存在，同时测试多个文件的时候，就总体而言仍然是并行的。")]),t("h2",{attrs:{id:"-"}},[s._v("结尾")]),t("p",[s._v("ava 还有很多的用法和需要注意的地方。最好的办法还是看文档，然后自己写 demo，反复领会，并应用在实际业务中。")]),t("p",[s._v("上面提到的内容，可能有不少错误。希望懂行的大神们能够提出来。")]),t("p",[s._v("突然想到古人说，“苟日新，又日新，日日新”。")]),t("p",[s._v("虽然经过今人考证，这也许只是类似甲骨文的祭祀记录的误读。但几千年来，这种“新”的精神始终在。")]),t("p",[s._v("程序世界里，变化更是无时不在。今天的工具，明天也许就会被淘汰。")]),t("p",[s._v("其实说到底，能够解决需求，能够方便高效使用的，才是最好的。")]),t("p",[s._v("向做出这些工具的大神们致敬。")]),t("h2",{attrs:{id:"-"}},[s._v("更新")]),t("h3",{attrs:{id:"a-"}},[s._v("a 标签点击事件的坑")]),t("p",[t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("a")]),s._v(" 标签的点击事件用了事件代理，然后通过手动触发无效。")]),t("p",[s._v("经测试，在浏览器也有这种问题。")]),t("p",[s._v("解决办法是直接使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("$('a')[0].click()")]),s._v("，原生的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("click")]),s._v(" 方法比较靠谱。")]),s._m(6)])]),s.post.prev.title||s.post.next.title?t("nav",{staticClass:"pagination"},[s.post.prev.title?t("nuxt-link",{staticClass:"prev",attrs:{to:"/post/"+s.post.prev.pathname,title:s.post.prev.title}},[s._v("« "+s._s(s.post.prev.title))]):s._e(),s.post.next.title?t("nuxt-link",{staticClass:"next",attrs:{to:"/post/"+s.post.next.pathname,title:s.post.next.title}},[s._v(s._s(s.post.next.title)+" »")]):s._e()],1):s._e(),t("gitalk",{attrs:{tags:s.tags}})],1)};e._withStripped=!0;var i={render:e,staticRenderFns:[function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("我将自己的 demo 放到了 github 上，地址是"),a("a",{attrs:{href:"https://github.com/AngusFu/jsdom-ava-demo",target:"_blank"}},[this._v("https://github.com/AngusFu/jsdom-ava-demo")]),this._v("。你可以直接克隆项目，然后在本地跑起来。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("ul",[a("li",[a("p",[this._v("测试脚本要经过 babel 6 编译一遍，有耗时；")])]),a("li",[a("p",[this._v("jsdom 系统比较庞大，解析起来费劲；")])]),a("li",[a("p",[this._v("我使用了 jsdom 的 jQueryify 方法从外部加载了 jQuery 文件（但这方法确实给力）；")])]),a("li",[a("p",[this._v("ava 本身其他方面的问题；")])])])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("友情提示：ava 的文档地址，"),a("a",{attrs:{href:"https://github.com/avajs/ava",target:"_blank"}},[this._v("https://github.com/avajs/ava")]),this._v("，也有中文版，但是没更新同步，所以建议还是看英文，否则用了一些过时的 API，以后升级之后追悔莫及。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("ul",[a("li",[a("p",[this._v("js 基础不够牢，对相关机制的了解还不透彻")])]),a("li",[a("p",[this._v("你被各种异步玩怕了（hybrid / RN 后遗症 ）")])])])},function(){var s=this.$createElement,a=this._self._c||s;return a("blockquote",[a("p",[this._v("You must define all tests synchronously. They can't be defined inside setTimeout, setImmediate, etc.\n所有测试必须同步定义。不能放在 setTimeout、setImmediate 等方法里面。")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("所以就有了 "),a("a",{attrs:{href:"https://github.com/AngusFu/jsdom-ava-demo/blob/master/parallel.js",target:"_blank"}},[this._v("parallel.js")]),this._v(" 这个文件。添加的测试用例如下：")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("参考： "),a("a",{attrs:{href:"http://stackoverflow.com/questions/773639/how-can-i-simulate-an-anchor-click-via-jquery",target:"_blank"}},[this._v("http://stackoverflow.com/questions/773639/how-can-i-simulate-an-anchor-click-via-jquery")])])}]};a.a=i},PBRg:function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=t("Vg6W"),i=t("+Ddb"),n=t("VU/8")(e.a,i.a,!1,null,null,null);n.options.__file="pages/post/test-with-ava-jsdom.vue",a.default=n.exports},Vg6W:function(s,a,t){"use strict";var e={title:"使用 ava 和 jsdom 测试前端界面",description:"使用 ava 和 jsdom 测试前端界面",keywords:"原创,测试,JavaScript",pathname:"test-with-ava-jsdom",translation:null,create_time:"2016-06-29",prev:{title:"判断资源并行加载完成的三种办法：计数、Promise及 $.Deferred",pathname:"when-are-all-resources-all-loaded"},next:{title:"[译] 防火墙背后的笔记：Web 设计在中国",pathname:"notes-from-behind-the-firewall-the-state-of-web-design-in-china"}};a.a={head:function(){return{title:e.title,meta:[{name:"keywords",content:e.keywords||""},{name:"description",content:e.description}]}},data:function(){return{post:e,post_url:this.$config.site_url+"/post/"+e.pathname,tags:e.tags}},mounted:function(){this.$fixCode()}}}});
webpackJsonp([46],{"+Vey":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("KwKw"),i=s("RMBT"),n=s("VU/8")(a.a,i.a,!1,null,null,null);n.options.__file="pages/post/js-set-immediate.vue",t.default=n.exports},KwKw:function(e,t,s){"use strict";var a={title:"关于 setImmediate",description:"关于 setImmediate",keywords:"原创,JavaScript",pathname:"js-set-immediate",translation:null,create_time:"2016-10-27",prev:{title:"JavaScript Weekly 307 阅读笔记",pathname:"javascript-weekly-307"},next:{title:"2016 年 10 月 27 日阅读笔记",pathname:"20161027-reading"}};t.a={head:function(){return{title:a.title,meta:[{name:"keywords",content:a.keywords||""},{name:"description",content:a.description}]}},data:function(){return{post:a,post_url:this.$config.site_url+"/post/"+a.pathname,tags:a.tags}},mounted:function(){this.$fixCode()}}},RMBT:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"page-post"}},[s("article",{staticClass:"post detail"},[s("div",{staticClass:"meta"},[s("div",{staticClass:"date"},[e._v(e._s(e.post.create_time))])]),s("h1",{staticClass:"title"},[e._v(e._s(e.post.title))]),s("div",{staticClass:"entry-content"},[e.post.translation?s("blockquote",[s("p",{staticStyle:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[e._v("\n        原文作者: "),s("a",{attrs:{href:e.post.translation.social,target:"_blank"}},[e._v(e._s(e.post.translation.author))]),s("br"),e._v("\n        原文地址: "),s("a",{attrs:{href:e.post.translation.from}},[e._v(e._s(e.post.translation.from))]),s("br"),e._v("\n        译文地址: "),s("a",{attrs:{href:e.post_url}},[e._v(e._s(e.post_url))]),s("br"),e._v("\n        本文由 "),s("a",{attrs:{href:this.$config.site_url}},[e._v(e._s(this.$config.site_owner))]),e._v(" 翻译，转载请保留此声明。"),s("br"),e._v("\n        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。\n        ")])]):e._e(),s("h2",{attrs:{id:"w3c-draft"}},[e._v("W3C Draft")]),e._m(0),s("p",[e._v("题目叫 “Efficient Script Yielding”，一份 2011 年的 “Editor's Draft”，从题目就能看出用途。建议有时间读一遍，超级短。摘要就一句话：")]),e._m(1),s("h2",{attrs:{id:"mdn"}},[e._v("MDN")]),e._m(2),s("p",[e._v("MDN 的文档没得说。遇到问题去查查肯定不会害你，有时候运气好，还能读到翻译过来的中文版：")]),e._m(3),e._m(4),s("p",[e._v("MDN 文档中提到了三种模拟 setImmediate 的方式："),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("postMessage")]),e._v("、"),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("MessageChannel")]),e._v("、"),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("setTimeout(fn, 0)")]),e._v("。")]),s("h2",{attrs:{id:"setimmediate-polyfill"}},[e._v("setImmediate polyfill")]),e._m(5),s("p",[e._v("对于 Node 0.9 之前的，使用 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("process.nextTick")]),e._v(" 模拟；对于非 IE 10 的现代浏览器，使用 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("postMessage")]),e._v("；对 Web Worker，使用 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("MessageChannel")]),e._v("（这个之后需要关注下）；对 IE 6–8，向 html 中插入新的 script 标签，在 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("onreadystatechange")]),e._v(" 事件中执行回调；其他浏览器，统一使用 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("setTimeout(fn, 0)")]),e._v(" 的形式。")]),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[e._v('<code class="hljs lang-javascript">%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20Don\'t%20get%20fooled%20by%20e.g.%20browserify%20environments.%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%20(%7B%7D.toString.call(global.process)%20%3D%3D%3D%20%3Cspan%20class%3D%22hljs-string%22%3E%22%5Bobject%20process%5D%22%3C%2Fspan%3E)%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20For%20Node.js%20before%200.9%3C%2Fspan%3E%0A%20%20%20%20installNextTickImplementation()%3B%0A%0A%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%20(canUsePostMessage())%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20For%20non-IE10%20modern%20browsers%3C%2Fspan%3E%0A%20%20%20%20installPostMessageImplementation()%3B%0A%0A%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%20(global.MessageChannel)%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20For%20web%20workers%2C%20where%20supported%3C%2Fspan%3E%0A%20%20%20%20installMessageChannelImplementation()%3B%0A%0A%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%20(doc%20%26amp%3B%26amp%3B%20%3Cspan%20class%3D%22hljs-string%22%3E%22onreadystatechange%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E%20doc.createElement(%3Cspan%20class%3D%22hljs-string%22%3E%22script%22%3C%2Fspan%3E))%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20For%20IE%206%E2%80%938%3C%2Fspan%3E%0A%20%20%20%20installReadyStateChangeImplementation()%3B%0A%0A%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20For%20older%20browsers%3C%2Fspan%3E%0A%20%20%20%20installSetTimeoutImplementation()%3B%0A%7D</code>')]),s("h2",{attrs:{id:"nicholas-c-zakas-"}},[e._v("Nicholas C. Zakas 的文章")]),e._m(6),s("p",[e._v("文章很短，但讲得还挺仔细的。作者提到了两点好处：")]),e._m(7),s("h2",{attrs:{id:"edge-demo"}},[e._v("Edge Demo")]),e._m(8),s("p",[e._v("通过 250 个数的排序，来对比处理效率。基本原理是，排序时将每一步的交换操作放在回调中，对比排序完成的效率。一共有四种：")]),s("ul",[s("li",[s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("setTimeout(fn, 15)")])]),s("li",[s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("setTimeout(fn, 4)")])]),s("li",[s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("PostMessage")])]),s("li",[s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("setImmediate")])])]),s("p",[e._v("关于前两种的时间间隔问题，建议直接取读 demo 底部的说明。已经很详细了。")]),s("h2",{attrs:{id:"stackoverflow"}},[e._v("Stackoverflow")]),e._m(9),s("h2",{attrs:{id:"-"}},[e._v("题外话")]),s("ul",[s("li",[s("p",[e._v("以前竟然不知道 setTimeout 也能接收第三个第四个参数的。"),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("setTimeout((a, b) => a + b, 0, 22, 33)")]),e._v("。")])]),s("li",[s("p",[s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("!(x > 9)")]),e._v(" 和 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("x <= 9")]),e._v(" 可不一定完全等价，前者在不确定 "),s("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("x")]),e._v(" 的类型时，特别有用，不用额外判断 undefined。")])])])])]),e.post.prev.title||e.post.next.title?s("nav",{staticClass:"pagination"},[e.post.prev.title?s("nuxt-link",{staticClass:"prev",attrs:{to:"/post/"+e.post.prev.pathname,title:e.post.prev.title}},[e._v("« "+e._s(e.post.prev.title))]):e._e(),e.post.next.title?s("nuxt-link",{staticClass:"next",attrs:{to:"/post/"+e.post.next.pathname,title:e.post.next.title}},[e._v(e._s(e.post.next.title)+" »")]):e._e()],1):e._e(),s("gitalk",{attrs:{tags:e.tags}})],1)};a._withStripped=!0;var i={render:a,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html",target:"_blank"}},[this._v("文档地址")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("blockquote",[t("p",[this._v("This specification defines an interface for web applications to flush the browser event queue and receive an immediate callback.\n本说明文档定义了一个用于刷新浏览器事件队列、接收即时回调的 Web 应用接口。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/setImmediate",target:"_blank"}},[this._v("文档地址")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("blockquote",[t("p",[this._v("This method is used to break up long running operations and run a callback function immediately after the browser has completed other operations such as events and display updates.\n该方法用来把一些需要长时间运行的操作放在一个回调函数里,在浏览器完成后面的其他语句后,就立刻执行这个回调函数。")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("但同时，文档提到， "),t("strong",[this._v("只有 IE 10+ 和 Node.js 0.10+ 实现了该方法")]),this._v("。setImmediate 受到了 Gecko 和 Webkit 的 “resistance”（抵制）。建议跟着去看看热闹。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/YuzuJS/setImmediate",target:"_blank"}},[this._v("源码")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://www.nczonline.net/blog/2011/09/19/script-yielding-with-setimmediate/",target:"_blank"}},[this._v("文章地址")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("可以直接在 UI 队列清空后直接插入 JS 任务；")]),t("li",[this._v("延迟更短，不必等待下一次 timer tick")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://msedgeportal.trafficmanager.net/en-us/microsoft-edge/testdrive/demos/setImmediateSorting/",target:"_blank"}},[this._v("Demo 地址")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("p",[t("a",{attrs:{href:"http://stackoverflow.com/questions/15349733/setimmediate-vs-nexttick",target:"_blank"}},[this._v("setImmediate vs. nextTick")])])]),t("li",[t("p",[t("a",{attrs:{href:"http://stackoverflow.com/questions/17502948/nexttick-vs-setimmediate-visual-explanation",target:"_blank"}},[this._v("nextTick vs setImmediate, visual explanation")])])])])}]};t.a=i}});
webpackJsonp([73],{"QH1/":function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=t("py1c"),n=t("ypY9"),l=t("VU/8")(e.a,n.a,!1,null,null,null);l.options.__file="pages/post/es-modules-in-browsers.vue",a.default=l.exports},py1c:function(s,a,t){"use strict";var e={title:"[译] 浏览器中的 ES6 module 实现",description:"浏览器中的 ES6 module 实现",keywords:"翻译,ES6",pathname:"es-modules-in-browsers",translation:{author:"@Jake Archibald",social:"https://jakearchibald.com/",from:"https://jakearchibald.com/2017/es-modules-in-browsers/"},create_time:"2017-05-06",prev:{title:"Chrome 中的 “Tab to Search” 与 Open Search",pathname:"opensearch"},next:{title:"Facebook 开源代码优化工具 Prepack",pathname:"prepack"}};a.a={head:function(){return{title:e.title,meta:[{name:"keywords",content:e.keywords||""},{name:"description",content:e.description}]}},data:function(){return{post:e,post_url:this.$config.site_url+"/post/"+e.pathname,tags:e.tags}},mounted:function(){this.$fixCode()}}},ypY9:function(s,a,t){"use strict";var e=function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{attrs:{id:"page-post"}},[t("article",{staticClass:"post detail"},[t("div",{staticClass:"meta"},[t("div",{staticClass:"date"},[s._v(s._s(s.post.create_time))])]),t("h1",{staticClass:"title"},[s._v(s._s(s.post.title))]),t("div",{staticClass:"entry-content"},[s.post.translation?t("blockquote",[t("p",{staticStyle:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[s._v("\n        原文作者: "),t("a",{attrs:{href:s.post.translation.social,target:"_blank"}},[s._v(s._s(s.post.translation.author))]),t("br"),s._v("\n        原文地址: "),t("a",{attrs:{href:s.post.translation.from}},[s._v(s._s(s.post.translation.from))]),t("br"),s._v("\n        译文地址: "),t("a",{attrs:{href:s.post_url}},[s._v(s._s(s.post_url))]),t("br"),s._v("\n        本文由 "),t("a",{attrs:{href:this.$config.site_url}},[s._v(s._s(this.$config.site_owner))]),s._v(" 翻译，转载请保留此声明。"),t("br"),s._v("\n        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。\n        ")])]):s._e(),t("p",[s._v("ES6 的模块特性（module） 开始在浏览器端实现啦！一切正在路上...")]),t("table",[s._m(0),t("tbody",[s._m(1),t("tr",[t("td",[s._v("Chrome Canary 60")]),t("td",[s._v("打开 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("chrome:flags")]),s._v(" 启用“实验性网络平台功能”")])]),t("tr",[t("td",[s._v("Firefox 54")]),t("td",[s._v("打开 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("about:config")]),s._v(" 启用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("dom.moduleScripts.enabled")])])]),t("tr",[t("td",[s._v("Edge 15")]),t("td",[s._v("打开 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("about:flags")]),s._v(" 启用“实验性 JavaScript 功能”")])])])]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-html\">%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22javascript%22%3E%0A%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7BaddTextToBody%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'.%2Futils.js'%3C%2Fspan%3E%3B%0A%0A%20%20addTextToBody(%3Cspan%20class%3D%22hljs-string%22%3E'Modules%20are%20pretty%20cool.'%3C%2Fspan%3E)%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20utils.js%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eexport%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-title%22%3EaddTextToBody%3C%2Fspan%3E(%3Cspan%20class%3D%22hljs-params%22%3Etext%3C%2Fspan%3E)%20%3C%2Fspan%3E%7B%0A%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E%20div%20%3D%20%3Cspan%20class%3D%22hljs-built_in%22%3Edocument%3C%2Fspan%3E.createElement(%3Cspan%20class%3D%22hljs-string%22%3E'div'%3C%2Fspan%3E)%3B%0A%20%20div.textContent%20%3D%20text%3B%0A%20%20%3Cspan%20class%3D%22hljs-built_in%22%3Edocument%3C%2Fspan%3E.body.appendChild(div)%3B%0A%7D</code>")]),s._m(2),t("p",[s._v("只需为 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("script")]),s._v(" 元素添加 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("type=module")]),s._v(" 属性，浏览器就会把该元素对应的内联脚本或外部脚本当成 ECMAScript 模块进行处理。")]),s._m(3),t("h2",{attrs:{id:"-import-"}},[s._v("尚未得到支持的 import 路径符号")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20%E6%94%AF%E6%8C%81%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7Bfoo%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'https%3A%2F%2Fjakearchibald.com%2Futils%2Fbar.js'%3C%2Fspan%3E%3B%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7Bfoo%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'%2Futils%2Fbar.js'%3C%2Fspan%3E%3B%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7Bfoo%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'.%2Fbar.js'%3C%2Fspan%3E%3B%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7Bfoo%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'..%2Fbar.js'%3C%2Fspan%3E%3B%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20%E4%B8%8D%E6%94%AF%E6%8C%81%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7Bfoo%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'bar.js'%3C%2Fspan%3E%3B%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7Bfoo%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'utils%2Fbar.js'%3C%2Fspan%3E%3B</code>")]),t("p",[s._v("有效的路径符号应当符合以下条件规则之一：")]),t("ul",[t("li",[s._v("完整的非相对路径。这样在将其传给"),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("new URL(moduleSpecifier)")]),s._v("的时候才不会报错。")]),t("li",[s._v("以 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("/")]),s._v(" 开头。")]),t("li",[s._v("以 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("./")]),s._v(" 开头。")]),t("li",[s._v("以 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("../")]),s._v(" 开头。")])]),t("p",[s._v("其他形式的符号被保留下来，未来将用于其他功能（如引入[import]内置模块）。")]),t("h2",{attrs:{id:"-nomodule-"}},[s._v("使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("nomodule")]),s._v(" 属性向后兼容")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-html">%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Enomodule%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22fallback.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>')]),s._m(4),t("p",[s._v("支持 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("type=module")]),s._v(" 的浏览器将会忽略带有 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("nomodule")]),s._v(" 属性的 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("script")]),s._v(" 标签。这意味着我们可以为支持模块的浏览器提供模块形式的代码，同时为那些不支持模块的浏览器提供降级处理。")]),t("h3",{attrs:{id:"-issue"}},[s._v("浏览器 issue")]),t("ul",[t("li",[s._v("Firefox 暂不支持 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("nomodule")]),s._v(" ("),t("a",{attrs:{href:"https://bugzilla.mozilla.org/show_bug.cgi?id=1330900",target:"_blank"}},[s._v("issue")]),s._v(")。")]),t("li",[s._v("Edge 暂不支持 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("nomodule")]),s._v(" ("),t("a",{attrs:{href:"https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/10525830/",target:"_blank"}},[s._v("issue")]),s._v(")。")]),t("li",[s._v("Safari 10.1 暂不支持 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("nomodule")]),s._v("，但在最新的技术预览版中已经解决了此问题。对于 10.1 来说，有一个"),t("a",{attrs:{href:"https://gist.github.com/samthor/64b114e4a4f539915a95b91ffd340acc",target:"_blank"}},[s._v("相当棒的解决方案")]),s._v("。")])]),t("h2",{attrs:{id:"-"}},[s._v("默认延迟执行")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-html">%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%BC%9A%E5%9C%A8%E2%80%A6%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E2%80%A6%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%B9%8B%E5%90%8E%E3%80%81%E2%80%A6%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%222.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E2%80%A6%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%B9%8B%E5%89%8D%E6%89%A7%E8%A1%8C%E3%80%82%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Edefer%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%223.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>')]),t("p",[s._m(5),s._v("。脚本执行顺序为 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("2.js")]),s._v(", "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("1.js")]),s._v(", "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("3.js")]),s._v("。")]),t("p",[s._v("获取脚本会导致 HTML parser 阻塞，这简直太太太太恶心了。对正常的脚本，我们可以使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("defer")]),s._v(" 属性来防止阻塞，脚本将延迟至文档解析完毕后执行，同时保持与其他使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("defer")]),s._v(" 的脚本之间的执行顺序。模块脚本的默认行为与 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("defer")]),s._v(" 相同 —— 无法使模块脚本阻塞 HTML parser。")]),t("p",[s._v("模块脚本与使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("defer")]),s._v(" 的正常脚本使用相同的执行队列。")]),t("h2",{attrs:{id:"-"}},[s._v("内联脚本同样延迟")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-html">%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%BC%9A%E5%9C%A8%E2%80%A6%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22actionscript%22%3E%0A%20%20addTextToBody(%3Cspan%20class%3D%22hljs-string%22%3E%22Inline%20module%20executed%22%3C%2Fspan%3E)%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E2%80%A6%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E2%80%A6%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E2%80%A6%E4%BB%A5%E5%8F%8A%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%B9%8B%E5%90%8E%E3%80%81%E2%80%A6%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Edefer%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22actionscript%22%3E%0A%20%20addTextToBody(%3Cspan%20class%3D%22hljs-string%22%3E%22Inline%20script%20executed%22%3C%2Fspan%3E)%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E2%80%A6%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%B9%8B%E5%89%8D%E6%89%A7%E8%A1%8C%E3%80%82%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Edefer%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%222.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>')]),t("p",[s._m(6),s._v("。执行顺序依次为 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("1.js")]),s._v("、内联脚本、内联模块、"),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("2.js")]),s._v("。")]),t("p",[s._v("正常的内联脚本会忽略 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("defer")]),s._v(" 属性，而内联模块则总是延迟执行，无论是否引入其他内容。")]),t("h2",{attrs:{id:"-async-"}},[t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("async")]),s._v(" 对内联、外部模块同样适用")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-html\">%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E8%84%9A%E6%9C%AC%E5%B0%86%E4%BC%9A%E5%9C%A8%E5%85%B6%E5%BC%95%E5%85%A5%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%90%8E%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Easync%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22javascript%22%3E%0A%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20%7BaddTextToBody%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'.%2Futils.js'%3C%2Fspan%3E%3B%0A%0A%20%20addTextToBody(%3Cspan%20class%3D%22hljs-string%22%3E'Inline%20module%20executed.'%3C%2Fspan%3E)%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E8%84%9A%E6%9C%AC%E5%8F%8A%E5%85%B6%E5%BC%95%E5%85%A5%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E5%90%8E%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Easync%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>")]),s._m(7),t("p",[s._v("与正常脚本相同，带有 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("async")]),s._v(" 属性的脚本在下载时不会阻塞 HTML parser，一旦加载完毕，立即执行。不同的是，"),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("async")]),s._v(" 对内联模块也同样适用。")]),t("p",[s._v("使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("async")]),s._v(" 时，脚本的执行顺序可能会和它们在 DOM 中出现的顺序不尽相同。")]),t("h3",{attrs:{id:"-issue"}},[s._v("浏览器 issue")]),t("ul",[t("li",[s._v("Firefox 不支持内联模块使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("async")]),s._v("("),t("a",{attrs:{href:"https://bugzilla.mozilla.org/show_bug.cgi?id=1361369",target:"_blank"}},[s._v("issue")]),s._v(")。")])]),t("h2",{attrs:{id:"-"}},[s._v("模块只执行一次")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-html">%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%201.js%20%E5%8F%AA%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AC%A1%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22actionscript%22%3E%0A%20%20%3Cspan%20class%3D%22hljs-meta%22%3E%3Cspan%20class%3D%22hljs-meta-keyword%22%3Eimport%3C%2Fspan%3E%20%22.%2F1.js%22%3B%3C%2Fspan%3E%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E6%99%AE%E9%80%9A%E8%84%9A%E6%9C%AC%E4%BC%9A%E6%89%A7%E8%A1%8C%E5%A4%9A%E6%AC%A1%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%222.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%222.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>')]),s._m(8),t("p",[s._v("引入同一个模块多次的时候，模块只会执行一次。这对 HTML 中的模块脚本同样适用 —— 在同一个页面中，URL 相同的模块只会执行一次。")]),t("h3",{attrs:{id:"-issue"}},[s._v("浏览器 issue")]),s._m(9),t("h2",{attrs:{id:"-cors"}},[s._v("总是使用 CORS")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-html\">%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E6%A8%A1%E5%9D%97%E4%B8%8D%E4%BC%9A%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%9B%A0%E5%85%B6%E6%9C%AA%E9%80%9A%E8%BF%87%20CORS%20%E6%A3%80%E6%9F%A5%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22https%3A%2F%2F%E2%80%A6.now.sh%2Fno-cors%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E6%A8%A1%E5%9D%97%E4%B8%8D%E4%BC%9A%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%9B%A0%E5%85%B6%E5%BC%95%E5%85%A5%E7%9A%84%E8%84%9A%E6%9C%AC%E6%9C%AA%E9%80%9A%E8%BF%87%20CORS%20%E6%A3%80%E6%9F%A5%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22actionscript%22%3E%0A%20%20%3Cspan%20class%3D%22hljs-meta%22%3E%3Cspan%20class%3D%22hljs-meta-keyword%22%3Eimport%3C%2Fspan%3E%20'https%3A%2F%2F%E2%80%A6.now.sh%2Fno-cors'%3B%3C%2Fspan%3E%0A%0A%20%20addTextToBody(%3Cspan%20class%3D%22hljs-string%22%3E%22This%20will%20not%20execute.%22%3C%2Fspan%3E)%3B%0A%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20CORS%20%E6%A3%80%E6%9F%A5%E9%80%9A%E8%BF%87%EF%BC%8C%E6%A8%A1%E5%9D%97%E5%B0%86%E4%BC%9A%E6%89%A7%E8%A1%8C%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22https%3A%2F%2F%E2%80%A6.now.sh%2Fcors%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>")]),s._m(10),t("p",[s._v("与正常脚本不同，模块脚本（及其引入的脚本）是通过 CORS 获取的。这意味着，跨域模块脚本必须返回类似 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("Access-Control-Allow-Origin: *")]),s._v(" 这样的有效的响应头。")]),t("h3",{attrs:{id:"-issue"}},[s._v("浏览器 issue")]),s._m(11),t("h2",{attrs:{id:"-"}},[s._v("不携带凭证信息")]),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v('<code class="hljs lang-html">%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E8%AF%B7%E6%B1%82%E8%84%9A%E6%9C%AC%E6%97%B6%E4%BC%9A%E6%90%BA%E5%B8%A6%E7%9B%B8%E5%85%B3%E5%87%AD%E8%AF%81%20(%E5%A6%82%20cookie)%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E4%B8%8D%E4%BC%9A%E6%90%BA%E5%B8%A6%E7%9B%B8%E5%85%B3%E5%87%AD%E8%AF%81%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E4%BC%9A%E6%90%BA%E5%B8%A6%E7%9B%B8%E5%85%B3%E5%87%AD%E8%AF%81%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Ecrossorigin%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%221.js%3F%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E4%B8%8D%E4%BC%9A%E6%90%BA%E5%B8%A6%E7%9B%B8%E5%85%B3%E5%87%AD%E8%AF%81%20--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Ecrossorigin%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22https%3A%2F%2Fother-origin%2F1.js%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%0A%3Cspan%20class%3D%22hljs-comment%22%3E%26lt%3B!--%20%E4%BC%9A%E6%90%BA%E5%B8%A6%E7%9B%B8%E5%85%B3%E5%87%AD%E8%AF%81--%26gt%3B%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Etype%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22module%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Ecrossorigin%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22use-credentials%22%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esrc%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22https%3A%2F%2Fother-origin%2F1.js%3F%22%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3Cspan%20class%3D%22undefined%22%3E%3C%2Fspan%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Escript%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E</code>')]),s._m(12),t("p",[s._v("在请求同源的情况下，多数基于 CORS 的 API 都会发送凭证信息（credentials，如 Cookie）。但 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("fetch()")]),s._v(" 和模块脚本恰恰例外 —— 除非手动声明，否则是不会发送相关凭证的。")]),t("p",[s._v("对于一个同源的模块脚本，可以为其添加 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("crossorigin")]),s._v(" 属性（这看起来挺怪的，我已经在规范中提出这个"),t("a",{attrs:{href:"https://github.com/whatwg/html/issues/2557",target:"_blank"}},[s._v("问题")]),s._v("了），这样在请求时就可以携带相关凭证了。如果你还想将凭证发给其他域，请使用 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v('crossorigin="use-credentials"')]),s._v("。需要注意的是，接收凭证的域必须返回 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("Access-Control-Allow-Credentials: true")]),s._v(" 的响应头。")]),t("p",[s._v("此外，还有一个与“模块只会执行一次”这条规则相关的问题。浏览器是通过 URL 来区别不同模块的，所以如果你先请求了一个模块而不携带任何凭证，紧接着又携带凭证信息去请求该模块，那么第二次得到的依然是不携带凭证的请求所返回的模块。这正是我在上面代码中的 URL 后面加上“?”的原因。")]),t("h3",{attrs:{id:"-issue"}},[s._v("浏览器 issue")]),t("ul",[s._m(13),t("li",[s._v("即使添加了 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("crossorigin")]),s._v(" 属性，Safari 在请求同源脚本时也不会携带凭证信息("),t("a",{attrs:{href:"https://bugs.webkit.org/show_bug.cgi?id=171550",target:"_blank"}},[s._v("issue")]),s._v(")。")]),t("li",[s._v("Edge 则完全弄反了。请求同源模块时，Edge 默认会发送凭证信息，但如果手动添加了 "),t("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("crossorigin")]),s._v(" 属性，则又不会携带 ("),t("a",{attrs:{href:"https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11865956/",target:"_blank"}},[s._v("issue")]),s._v(")。")])]),t("p",[s._v("Firefox 是唯一正确实现这一点的浏览器 —— 好样的！")]),t("h2",{attrs:{id:"mime-types"}},[s._v("Mime-types")]),s._m(14),s._m(15),t("h3",{attrs:{id:"-issue"}},[s._v("浏览器 issue")]),s._m(16),t("hr"),t("p",[s._v("以上就是我目前所学习到的所有内容。浏览器开始支持 ES6 模块，简直太开心啦~")])])]),s.post.prev.title||s.post.next.title?t("nav",{staticClass:"pagination"},[s.post.prev.title?t("nuxt-link",{staticClass:"prev",attrs:{to:"/post/"+s.post.prev.pathname,title:s.post.prev.title}},[s._v("« "+s._s(s.post.prev.title))]):s._e(),s.post.next.title?t("nuxt-link",{staticClass:"next",attrs:{to:"/post/"+s.post.next.pathname,title:s.post.next.title}},[s._v(s._s(s.post.next.title)+" »")]):s._e()],1):s._e(),t("gitalk",{attrs:{tags:s.tags}})],1)};e._withStripped=!0;var n={render:e,staticRenderFns:[function(){var s=this.$createElement,a=this._self._c||s;return a("thead",[a("tr",[a("th",[this._v("浏览器")]),a("th",[this._v("备注")])])])},function(){var s=this.$createElement,a=this._self._c||s;return a("tr",[a("td",[this._v("Safari 10.1")]),a("td",[this._v("(无)")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://cdn.rawgit.com/jakearchibald/a298d5af601982c338186cd355e624a8/raw/aaa2cbee9a5810d14b01ae965e52ecb9b2965a44/",target:"_blank"}},[this._v("Live demo")])]),this._v("。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("目前已经有一些 "),a("a",{attrs:{href:"https://ponyfoo.com/articles/es6-modules-in-depth",target:"_blank"}},[this._v("很棒的关于 ECMAScript 模块的文章")]),this._v("了，不过我还是想分享一些和浏览器相关的东西，它们都是我在测试代码、阅读规范的过程中学习到的。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://cdn.rawgit.com/jakearchibald/6110fb6df717ebca44c2e40814cc12af/raw/7fc79ed89199c2512a4579c9a3ba19f72c219bd8/",target:"_blank"}},[this._v("Live demo")])]),this._v("。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("strong",[a("a",{attrs:{href:"https://cdn.rawgit.com/jakearchibald/d6808ea2665f8b3994380160dc2c0bc1/raw/c0a194aa70dda1339c960c6f05b2e16988ee66ac/",target:"_blank"}},[this._v("Live demo")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("strong",[a("a",{attrs:{href:"https://cdn.rawgit.com/jakearchibald/7026f72c0675898196f7669699e3231e/raw/fc7521aabd9485f30dbd5189b407313cd350cf2b/",target:"_blank"}},[this._v("Live demo")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://module-script-tests-rgjnxtrtqq.now.sh/async",target:"_blank"}},[this._v("Live demo")])]),this._v("。先完成加载的脚本先执行。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://cdn.rawgit.com/jakearchibald/f7f6d37ef1b4d8a4f908f3e80d50f4fe/raw/1fcedde007a2b90049a7ea438781aebe69e22762/",target:"_blank"}},[this._v("Live demo")])]),this._v("。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("ul",[a("li",[this._v("Edge 会执行多次 ("),a("a",{attrs:{href:"https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11865922/",target:"_blank"}},[this._v("issue")]),this._v(")。")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://cdn.rawgit.com/jakearchibald/2b8d4bc7624ca6a2c7f3c35f6e17fe2d/raw/fe04e60b0b7021f261e79b8ef28b0ccd132c1585/",target:"_blank"}},[this._v("Live demo")])]),this._v("。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("ul",[a("li",[this._v("Firefox 无法加载 demo 页面("),a("a",{attrs:{href:"https://bugzilla.mozilla.org/show_bug.cgi?id=1361373",target:"_blank"}},[this._v("issue")]),this._v(")。")]),a("li",[this._v("Edge 加载了没有 CORS 响应头的模块("),a("a",{attrs:{href:"https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11865934/",target:"_blank"}},[this._v("issue")]),this._v(")。")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://module-script-tests-zoelmqooyv.now.sh/cookie-page",target:"_blank"}},[this._v("Live demo")])]),this._v("。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("li",[this._v("请求同源模块时，Chrome 会携带凭证信息("),a("a",{attrs:{href:"https://bugs.chromium.org/p/chromium/issues/detail?id=717525",target:"_blank"}},[this._v("issue")]),this._v(")。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("不同于普通脚本，对于通过 module 引入的脚本，服务器必须返回"),a("a",{attrs:{href:"https://html.spec.whatwg.org/multipage/scripting.html#javascript-mime-type",target:"_blank"}},[this._v("合法的 MIME type")]),this._v("，否则脚本将不会执行。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[a("strong",[a("a",{attrs:{href:"https://module-script-tests-zoelmqooyv.now.sh/mime",target:"_blank"}},[this._v("Live demo")])]),this._v("。")])},function(){var s=this.$createElement,a=this._self._c||s;return a("ul",[a("li",[this._v("Edge 仍将执行 MIME type 非法的脚本("),a("a",{attrs:{href:"https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11865977/",target:"_blank"}},[this._v("issue")]),this._v(")。")])])}]};a.a=n}});
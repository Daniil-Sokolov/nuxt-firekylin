webpackJsonp([84],{cMNA:function(e,t,a){"use strict";var s={title:"react-native 开发 App 手记",description:"react-native 开发 App 手记",keywords:"原创,react-native,开发心得",pathname:"app-with-react-native",translation:null,create_time:"2016-04-22",prev:{title:"[译] No WebSockets Over HTTP2",pathname:"no-websockets-over-http2"},next:{title:"近来在Firefox上遇到的一些坑",pathname:"problems-with-firefox"}};t.a={head:function(){return{title:s.title,meta:[{name:"keywords",content:s.keywords||""},{name:"description",content:s.description}]}},data:function(){return{post:s,post_url:this.$config.site_url+"/post/"+s.pathname,tags:s.tags}},mounted:function(){this.$fixCode()}}},eIj5:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("cMNA"),i=a("sNC5"),r=a("VU/8")(s.a,i.a,!1,null,null,null);r.options.__file="pages/post/app-with-react-native.vue",t.default=r.exports},sNC5:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"page-post"}},[a("article",{staticClass:"post detail"},[a("div",{staticClass:"meta"},[a("div",{staticClass:"date"},[e._v(e._s(e.post.create_time))])]),a("h1",{staticClass:"title"},[e._v(e._s(e.post.title))]),a("div",{staticClass:"entry-content"},[e.post.translation?a("blockquote",[a("p",{staticStyle:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[e._v("\n        原文作者: "),a("a",{attrs:{href:e.post.translation.social,target:"_blank"}},[e._v(e._s(e.post.translation.author))]),a("br"),e._v("\n        原文地址: "),a("a",{attrs:{href:e.post.translation.from}},[e._v(e._s(e.post.translation.from))]),a("br"),e._v("\n        译文地址: "),a("a",{attrs:{href:e.post_url}},[e._v(e._s(e.post_url))]),a("br"),e._v("\n        本文由 "),a("a",{attrs:{href:this.$config.site_url}},[e._v(e._s(this.$config.site_owner))]),e._v(" 翻译，转载请保留此声明。"),a("br"),e._v("\n        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。\n        ")])]):e._e(),a("p",[e._v("做了一个月的 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("RN")]),e._v("。")]),a("p",[e._v("遇到一些问题，陆续记录下来。一些关于组件上的问题不细说了。")]),a("h2",{attrs:{id:"android-"}},[e._v("Android 下的键盘事件监听")]),e._m(0),a("p",[e._v("后来看到了 "),a("a",{attrs:{href:"https://github.com/Andr3wHur5t/react-native-keyboard-spacer/blob/master/KeyboardSpacer.js",target:"_blank"}},[e._v("react-native-keyboard-spacer")]),e._v("  这个组件的写法，很傻很天真的以为是需要使用什么 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("java")]),e._v(" 或 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("OC")]),e._v(" 的支持。")]),a("p",[e._v("于是我决定去看看源码。自己拿 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("nodejs")]),e._v(" 写了个简单的"),a("a",{attrs:{href:"https://github.com/AngusFu/SearchDirContent",target:"_blank"}},[e._v("内容搜索工具")]),e._v("，找到所有含有 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("keyboard")]),e._v(" 的 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("java")]),e._v(" 文件。这么一找，还真找到了。")]),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[e._v('<code class="hljs lang-java">%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%20(mKeyboardHeight%20!%3D%20heightDiff%20%26amp%3B%26amp%3B%20heightDiff%20%26gt%3B%20mMinKeyboardHeightDetected)%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20keyboard%20is%20now%20showing%2C%20or%20the%20keyboard%20height%20has%20changed%3C%2Fspan%3E%0A%20%20%20%20mKeyboardHeight%20%3D%20heightDiff%3B%0A%20%20%20%20WritableMap%20params%20%3D%20Arguments.createMap()%3B%0A%20%20%20%20WritableMap%20coordinates%20%3D%20Arguments.createMap()%3B%0A%20%20%20%20coordinates.putDouble(%3Cspan%20class%3D%22hljs-string%22%3E%22screenY%22%3C%2Fspan%3E%2C%20PixelUtil.toDIPFromPixel(mVisibleViewArea.bottom))%3B%0A%20%20%20%20coordinates.putDouble(%3Cspan%20class%3D%22hljs-string%22%3E%22screenX%22%3C%2Fspan%3E%2C%20PixelUtil.toDIPFromPixel(mVisibleViewArea.left))%3B%0A%20%20%20%20coordinates.putDouble(%3Cspan%20class%3D%22hljs-string%22%3E%22width%22%3C%2Fspan%3E%2C%20PixelUtil.toDIPFromPixel(mVisibleViewArea.width()))%3B%0A%20%20%20%20coordinates.putDouble(%3Cspan%20class%3D%22hljs-string%22%3E%22height%22%3C%2Fspan%3E%2C%20PixelUtil.toDIPFromPixel(mKeyboardHeight))%3B%0A%20%20%20%20params.putMap(%3Cspan%20class%3D%22hljs-string%22%3E%22endCoordinates%22%3C%2Fspan%3E%2C%20coordinates)%3B%0A%20%20%20%20sendEvent(%3Cspan%20class%3D%22hljs-string%22%3E%22keyboardDidShow%22%3C%2Fspan%3E%2C%20params)%3B%0A%7D%20%3Cspan%20class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%20(mKeyboardHeight%20!%3D%20%3Cspan%20class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%20%26amp%3B%26amp%3B%20heightDiff%20%26lt%3B%3D%20mMinKeyboardHeightDetected)%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20keyboard%20is%20now%20hidden%3C%2Fspan%3E%0A%20%20%20%20mKeyboardHeight%20%3D%20%3Cspan%20class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A%20%20%20%20sendEvent(%3Cspan%20class%3D%22hljs-string%22%3E%22keyboardDidHide%22%3C%2Fspan%3E%2C%20%3Cspan%20class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E)%3B%0A%7D</code>')]),a("p",[e._v("嗯，安卓下的事件就在这里了。"),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("keyboardDidShow")]),e._v(" 和 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("keyboardDidHide")]),e._v("。")]),a("p",[e._v("看来 "),a("a",{attrs:{href:"https://github.com/Andr3wHur5t/react-native-keyboard-spacer/blob/master/KeyboardSpacer.js",target:"_blank"}},[e._v("react-native-keyboard-spacer")]),e._v("  还是很靠谱的。于是从其中抽取了键盘的逻辑，做成了 "),a("a",{attrs:{href:"https://github.com/AngusFu/react-native-keyboard-event",target:"_blank"}},[e._v("react-native-keyboard-event")]),e._v(" 这个组件。可以使用 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("npm")]),e._v(" 来安装。")]),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[e._v("<code class=\"hljs lang-javascript\">%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20KeyListener%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'react-native-keyboard-event'%3C%2Fspan%3E%3B%0AKeyListener.show(onkeyboardShow).hide(onkeyboardHide)%3B%0A%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20Note%3C%2Fspan%3E%0A%3Cspan%20class%3D%22hljs-comment%22%3E%2F%2F%20event%20name%20is%20up%20to%20platform%3C%2Fspan%3E%0AKeyListener.hideEvent%3B%0AKeyListener.showEvent%3B</code>")]),a("h2",{attrs:{id:"fetch-"}},[e._v("fetch 方法")]),a("p",[a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("fetch")]),e._v(" 方法调用最好加上 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("done")]),e._v(" 方法，否则有时候会报错。")]),a("h2",{attrs:{id:"rn-"}},[e._v("RN 请求数量限制")]),a("p",[e._v("网络请求数量需要做限制。不能无限请求，否则请求都会被阻塞一直发布出去。")]),a("p",[e._v("为什么会遇到这种情况呢？因为底层有个死循环，四秒钟查找一次，是否有未上传的记录，若有则会通知前端上传，前端上传结果会反馈给底层。最后出现同一条记录反复通知反复失败的情况。通过分析日志，发现前端接到了通知，但 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[e._v("fetch")]),e._v(" 成功、失败的逻辑都没进去。")]),a("p",[e._v("最后的解决办法，很简单，底层对请求数量做限制。")]),a("p",[e._v("To be continued...")])])]),e.post.prev.title||e.post.next.title?a("nav",{staticClass:"pagination"},[e.post.prev.title?a("nuxt-link",{staticClass:"prev",attrs:{to:"/post/"+e.post.prev.pathname,title:e.post.prev.title}},[e._v("« "+e._s(e.post.prev.title))]):e._e(),e.post.next.title?a("nuxt-link",{staticClass:"next",attrs:{to:"/post/"+e.post.next.pathname,title:e.post.next.title}},[e._v(e._s(e.post.next.title)+" »")]):e._e()],1):e._e(),a("gitalk",{attrs:{tags:e.tags}})],1)};s._withStripped=!0;var i={render:s,staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("一直想找安卓下面的键盘事件，可是官方文档（0.22）压根就没提这档子事啊。唯一稍微有点眉目的，就是关于"),t("a",{attrs:{href:"http://reactnative.cn/docs/0.22/native-modules-android.html#%E5%8F%91%E9%80%81%E4%BA%8B%E4%BB%B6%E5%88%B0javascript",target:"_blank"}},[this._v("原生模块")]),this._v("这里。")])}]};t.a=i}});
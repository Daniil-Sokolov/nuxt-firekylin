webpackJsonp([88],{LR7i:function(s,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=a("kQxj"),n=a("rvMk"),i=a("VU/8")(e.a,n.a,!1,null,null,null);i.options.__file="pages/post/ajax-requests-in-react.vue",t.default=i.exports},kQxj:function(s,t,a){"use strict";var e={title:"[译] React 中的 AJAX 请求：获取数据的方法与时机",description:"React 中的 AJAX 请求：获取数据的方法与时机",keywords:"翻译,React",pathname:"ajax-requests-in-react",translation:{author:"Dave Ceddia",social:"https://daveceddia.com/",from:"https://daveceddia.com/ajax-requests-in-react/"},create_time:"2016-12-07",prev:{title:"[译] Bluebird 高性能揭秘",pathname:"javascript-performance-fundamentals-make-bluebird-fast"},next:{title:"前端界面 Modal 的控制",pathname:"accessible-modal"}};t.a={head:function(){return{title:e.title,meta:[{name:"keywords",content:e.keywords||""},{name:"description",content:e.description}]}},data:function(){return{post:e,post_url:this.$config.site_url+"/post/"+e.pathname,tags:e.tags}},mounted:function(){this.$fixCode()}}},rvMk:function(s,t,a){"use strict";var e=function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{attrs:{id:"page-post"}},[a("article",{staticClass:"post detail"},[a("div",{staticClass:"meta"},[a("div",{staticClass:"date"},[s._v(s._s(s.post.create_time))])]),a("h1",{staticClass:"title"},[s._v(s._s(s.post.title))]),a("div",{staticClass:"entry-content"},[s.post.translation?a("blockquote",[a("p",{staticStyle:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[s._v("\n        原文作者: "),a("a",{attrs:{href:s.post.translation.social,target:"_blank"}},[s._v(s._s(s.post.translation.author))]),a("br"),s._v("\n        原文地址: "),a("a",{attrs:{href:s.post.translation.from}},[s._v(s._s(s.post.translation.from))]),a("br"),s._v("\n        译文地址: "),a("a",{attrs:{href:s.post_url}},[s._v(s._s(s.post_url))]),a("br"),s._v("\n        本文由 "),a("a",{attrs:{href:this.$config.site_url}},[s._v(s._s(this.$config.site_owner))]),s._v(" 翻译，转载请保留此声明。"),a("br"),s._v("\n        著作权属于原作者，本译文仅用于学习、研究和交流目的，请勿用于商业目的。\n        ")])]):s._e(),a("p",[s._v("React 新手一开始可能会问到这样一个问题，“在 React 中如何发送 AJAX 请求呢？”")]),a("p",[s._v("本文正要回答该问题。")]),a("p",[s._v("首先：React 本身对获取数据的方式并无任何特殊偏好。实际上，在 React 的图景中，根本就不知道“服务器”这种东西的存在。")]),s._m(0),a("p",[s._v("因此，想要使用来自服务端的数据，必须将数据放入组件的 props 或 state 中。")]),a("p",[s._v("你完全可以按照喜好使用服务、数据模型（额，“建立抽象”）完成这个过程，但归根结底只不过是通过 props 和 state 渲染组件。")]),a("h4",{attrs:{id:"-http-"}},[s._v("选择 HTTP 工具库")]),a("p",[s._v("要从服务端拿到数据，首先得有一个 HTTP 工具库。现成的轮子数都数不清。它们最终做的事情都一样，但在一些特性上有所不同。")]),s._m(1),s._m(2),s._m(3),a("p",[s._v("这些其实根本不重要。没有“最佳”工具。")]),a("p",[s._v("有些人可能会说，"),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("fetch")]),s._v(" 是最好的，因为 fetch 差不多已经是标准了。但我敢打赌，就算fetch "),a("strong",[s._v("真正")]),s._v("成为标准，还是会有人喜欢、使用一些与之匹敌的 HTTP 工具库。所以随你怎么选咯。")]),s._m(4),a("h4",{attrs:{id:"-"}},[s._v("获取数据")]),a("p",[s._v("下面是一个简单的示例组件，它从 Reddit 站点获取文章列表。先看一眼，后面会讲述代码是如何工作的。")]),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20React%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'react'%3C%2Fspan%3E%3B%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20ReactDOM%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'react-dom'%3C%2Fspan%3E%3B%0A%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20axios%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'axios'%3C%2Fspan%3E%3B%0A%0A%3Cspan%20class%3D%22hljs-class%22%3E%3Cspan%20class%3D%22hljs-keyword%22%3Eclass%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-title%22%3EFetchDemo%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-keyword%22%3Eextends%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-title%22%3EReact%3C%2Fspan%3E.%3Cspan%20class%3D%22hljs-title%22%3EComponent%3C%2Fspan%3E%20%3C%2Fspan%3E%7B%0A%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Econstructor%3C%2Fspan%3E(props)%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Esuper%3C%2Fspan%3E(props)%3B%0A%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.state%20%3D%20%7B%0A%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-attr%22%3Eposts%3C%2Fspan%3E%3A%20%5B%5D%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%0A%20%20componentDidMount()%20%7B%0A%20%20%20%20axios.get(%3Cspan%20class%3D%22hljs-string%22%3E%60http%3A%2F%2Fwww.reddit.com%2Fr%2F%3Cspan%20class%3D%22hljs-subst%22%3E%24%7B%3Cspan%20class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.props.subreddit%7D%3C%2Fspan%3E.json%60%3C%2Fspan%3E)%0A%20%20%20%20%20%20.then(%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-params%22%3Eres%3C%2Fspan%3E%20%3D%26gt%3B%3C%2Fspan%3E%20%7B%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E%20posts%20%3D%20res.data.data.children.map(%3Cspan%20class%3D%22hljs-function%22%3E%3Cspan%20class%3D%22hljs-params%22%3Eobj%3C%2Fspan%3E%20%3D%26gt%3B%3C%2Fspan%3E%20obj.data)%3B%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.setState(%7B%20posts%20%7D)%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20render()%20%7B%0A%20%20%20%20%3Cspan%20class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%20(%0A%20%20%20%20%20%20%3Cspan%20class%3D%22xml%22%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Ediv%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Eh1%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%7B%60%2Fr%2F%24%7Bthis.props.subreddit%7D%60%7D%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Eh1%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Eul%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%20%20%20%20%20%20%20%20%20%20%7Bthis.state.posts.map(post%20%3D%26gt%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3Eli%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Ekey%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%7Bpost.id%7D%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%7Bpost.title%7D%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Eli%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%20%20%20%20%20%20%20%20%20%20)%7D%0A%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Eul%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%0A%20%20%20%20%20%20%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%2F%3Cspan%20class%3D%22hljs-name%22%3Ediv%3C%2Fspan%3E%26gt%3B%3C%2Fspan%3E%3C%2Fspan%3E%0A%20%20%20%20)%3B%0A%20%20%7D%0A%7D%0A%0AReactDOM.render(%0A%20%20%3Cspan%20class%3D%22xml%22%3E%3Cspan%20class%3D%22hljs-tag%22%3E%26lt%3B%3Cspan%20class%3D%22hljs-name%22%3EFetchDemo%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-attr%22%3Esubreddit%3C%2Fspan%3E%3D%3Cspan%20class%3D%22hljs-string%22%3E%22reactjs%22%3C%2Fspan%3E%2F%26gt%3B%3C%2Fspan%3E%2C%0A%20%20document.getElementById('root')%0A)%3B%3C%2Fspan%3E</code>")]),a("h3",{attrs:{id:"-"}},[s._v("如何工作")]),a("p",[s._v("首先引入 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("axios")]),s._v("。")]),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"pre-area",attrs:{width:"0",height:"0"}},[s._v("<code class=\"hljs lang-javascript\">%3Cspan%20class%3D%22hljs-keyword%22%3Eimport%3C%2Fspan%3E%20axios%20%3Cspan%20class%3D%22hljs-keyword%22%3Efrom%3C%2Fspan%3E%20%3Cspan%20class%3D%22hljs-string%22%3E'axios'%3C%2Fspan%3E%3B</code>")]),a("p",[s._v("constructor 方法非常标准，调用 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("super")]),s._v("，然后初始化 state，设置一个空的 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("posts")]),s._v(" 数组。")]),a("p",[s._v("真正神奇的事情发生在 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("componentDidMount")]),s._v(" 方法中。组件首次“挂载”（mount）时，该方法就会执行。在组件生命周期中，该方法只会执行"),a("strong",[s._v("一次")]),s._v("。")]),a("p",[a("strong",[s._v("TL;DR:  在 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("componentDidMount")]),s._v(" 方法中获取服务端数据")])]),a("p",[a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("componentDidMount")]),s._v(" 方法中，根据传入的"),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("subreddit")]),s._v("属性，调用 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("axios.get")]),s._v(" 方法获取数据。反引号中是 ES6 模板字符串，可能如你所想，"),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("${...}")]),s._v(" 部分会被其中表达式的值所替换，因此传给 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("axios.get")]),s._v(" 的 URL 实际上是 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("http://www.reddit.com/r/reactjs.json")]),s._v("。")]),a("p",[s._v("此处需注意两点，和 Reddit 有关：")]),a("ul",[a("li",[a("p",[s._v("可以在 Reddit 网站下面所有的 URL 后面添加 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v(".json")]),s._v(" 后缀，以获取 JSON 格式的内容。")])]),a("li",[a("p",[s._v("如果去掉 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("www")]),s._v("，会产生 CORS 错误（至少我碰到了这个错误）。")])])]),a("p",[s._v("因为 Axios 使用了 Promise，所以可以通过 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v(".then")]),s._v(" 方法链式处理响应。经过一些处理后，"),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("posts")]),s._v(" 被提取出来了，紧接着是重点：")]),a("p",[s._v("传入新的 posts 数组，使用 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("this.setState")]),s._v(" 方法更新组件状态。这会导致重新渲染，接下来文章列表就显示出来了。")]),a("p",[s._v("这就是所有的一切啦哈哈！")]),a("h3",{attrs:{id:"-"}},[s._v("思考题：添加加载指示")]),a("p",[s._v('知道怎样修改代码，在请求尚未返回时添加一个 "Loading..." 消息吗？')]),a("p",[s._v("提示：在 state 中设置一个标志，一旦请求完成则将其切换其值。在 render 函数中使用这个标志显示加载提示。")]),a("p",[s._v("如果想看示例代码（包括加载提示以及附加奖励 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("error state")]),s._v("~），可以点击"),a("a",{attrs:{href:"https://daveceddia.com/freebies/react-ajax-example.zip",target:"_blank"}},[s._v("这里")]),s._v("下载可运行的例子，无需注册哟~")]),a("p",[s._v("解压文件，依次执行 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("npm install")]),s._v(" 和 "),a("textarea",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"codespan",attrs:{width:"0",height:"0"}},[s._v("npm start")]),s._v("。示例基于棒棒哒 "),a("a",{attrs:{href:"https://daveceddia.com/create-react-app-official-project-generator",target:"_blank"}},[s._v("Create React App")]),s._v(" 创建。")])])]),s.post.prev.title||s.post.next.title?a("nav",{staticClass:"pagination"},[s.post.prev.title?a("nuxt-link",{staticClass:"prev",attrs:{to:"/post/"+s.post.prev.pathname,title:s.post.prev.title}},[s._v("« "+s._s(s.post.prev.title))]):s._e(),s.post.next.title?a("nuxt-link",{staticClass:"next",attrs:{to:"/post/"+s.post.next.pathname,title:s.post.next.title}},[s._v(s._s(s.post.next.title)+" »")]):s._e()],1):s._e(),a("gitalk",{attrs:{tags:s.tags}})],1)};e._withStripped=!0;var n={render:e,staticRenderFns:[function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("React 只是使用 "),t("strong",[this._v("props")]),this._v(" 和 "),t("strong",[this._v("state")]),this._v(" 两处的数据进行组件渲染。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("喜欢 Promise？那就试试  "),t("a",{attrs:{href:"https://github.com/mzabriskie/axios",target:"_blank"}},[this._v("axios")]),this._v(" 吧。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("不喜欢 Promise，对回调函数情有独钟？可以看一眼 "),t("a",{attrs:{href:"https://github.com/visionmedia/superagent",target:"_blank"}},[this._v("superagent")]),this._v("。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("要不试试将要成为标准的一些工具？"),t("a",{attrs:{href:"https://github.com/github/fetch",target:"_blank"}},[this._v("fetch")]),this._v(" 可能是你的菜。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("我个人比较喜欢 "),t("a",{attrs:{href:"https://github.com/mzabriskie/axios",target:"_blank"}},[this._v("axios")]),this._v("，这也是本文示例所使用的。不过，认真的说，如果你偏偏不喜欢它，那就选其他的呗。")])}]};t.a=n}});